<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="google-site-verification" content="9uLHaP53sHpPBy6U9jzpeNOmJIbCl11ZRMo8hN7dyaw" />
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NextGen Library</title>
  <link rel="icon" type="image/png" href="favicon1.png">

  <style>
    /* Add external dependencies here */
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: white;
      transition: 0.4s;
    }

    /* HEADER */
    #globalTicker {
      background: #ff4757;
      color: white;
      padding: 8px;
      font-weight: bold;
      text-align: center;
      font-size: 14px;
      display: none;
    }

    header {
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #000000cc;
      flex-wrap: wrap;
    }

    @media (max-width: 480px) {
      header {
        padding: 10px;
        flex-direction: row;
        justify-content: space-between;
        gap: 10px;
      }

      header h2 {
        margin: 0;
        font-size: 20px;
      }
    }

    /* SEARCH */
    input {
      padding: 8px;
      border: none;
      border-radius: 5px;
    }

    /* LOGIN SCREEN */
    #loginScreen {
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      background: radial-gradient(circle at center, #001f3f, #000);
      position: absolute;
      width: 100%;
      top: 0;
      left: 0;
      z-index: 999;
    }

    .light #loginScreen {
      background: #f0f4f8;
    }

    .login-box {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(0, 255, 255, 0.3);
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      width: 90%;
      max-width: 400px;
    }

    .light .login-box {
      background: #ffffff;
      border: 1px solid #d1d5db;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .login-box h2 {
      margin-bottom: 25px;
      color: cyan;
      font-size: 28px;
      text-shadow: 0 0 10px cyan;
    }

    .light .login-box h2 {
      color: #0056b3;
      text-shadow: none;
    }

    .login-input {
      width: 100%;
      padding: 12px;
      margin-bottom: 20px;
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid cyan;
      color: white;
      font-size: 16px;
      outline: none;
      box-sizing: border-box;
      transition: 0.3s;
    }

    .light .login-input {
      background: #f9fafb;
      color: #333;
      border: 1px solid #ccc;
    }

    .login-input:focus {
      box-shadow: 0 0 10px cyan;
    }

    .light .login-input:focus {
      box-shadow: 0 0 10px #0056b3;
      border-color: #0056b3;
    }

    .login-btn {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      font-size: 18px;
      background: cyan;
      color: black;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
      box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
    }

    .light .login-btn {
      background: #0056b3;
      color: white;
      box-shadow: none;
    }

    .login-btn:hover {
      background: #00ffff;
      box-shadow: 0 0 25px cyan;
      transform: translateY(-2px);
    }

    .light .login-btn:hover {
      background: #004494;
      box-shadow: 0 4px 10px rgba(0, 86, 179, 0.3);
    }

    .auth-toggle {
      margin-top: 15px;
      font-size: 14px;
      color: #ddd;
    }

    .light .auth-toggle {
      color: #666;
    }

    .auth-toggle span {
      color: cyan;
      cursor: pointer;
      text-decoration: underline;
      font-weight: bold;
    }

    .light .auth-toggle span {
      color: #0056b3;
    }

    .admin-link {
      margin-top: 15px;
      font-size: 13px;
      color: #888;
      text-align: right;
      cursor: pointer;
      transition: 0.3s;
    }

    .admin-link:hover {
      color: cyan;
    }

    /* ADMIN DASHBOARD */
    #adminDashboard {
      display: none;
      padding: 30px;
      max-width: 1200px;
      margin: 40px auto;
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid cyan;
      border-radius: 15px;
      color: white;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
    }

    .light #adminDashboard {
      background: #fff;
      border-color: #ddd;
      color: black;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .admin-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .admin-table th,
    .admin-table td {
      border: 1px solid #444;
      padding: 12px;
      text-align: left;
    }

    .light .admin-table th,
    .light .admin-table td {
      border: 1px solid #ccc;
    }

    .admin-table th {
      background: #002233;
      color: cyan;
      font-size: 16px;
    }

    .light .admin-table th {
      background: #f0f4f8;
      color: #0056b3;
    }

    /* CMS DYNAMIC FIELDS */
    .cms-dynamic-field {
      display: flex;
      gap: 10px;
      margin-top: 5px;
      margin-bottom: 5px;
    }

    .cms-add-btn {
      background: #00cec9;
      color: black;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 13px;
      font-weight: bold;
      margin-top: 5px;
    }

    .cms-del-btn {
      background: #ff4757;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }

    /* SELECT DROPDOWN FOR SIGN UP */
    select.login-input {
      appearance: none;
      -webkit-appearance: none;
      background-image: url('data:image/svg+xml;utf8,<svg fill="cyan" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
      background-repeat: no-repeat;
      background-position-x: 95%;
      background-position-y: 50%;
    }

    .light select.login-input {
      background-image: url('data:image/svg+xml;utf8,<svg fill="%230056b3" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
    }

    select.login-input option {
      background: #001f3f;
      color: white;
    }

    .light select.login-input option {
      background: white;
      color: black;
    }

    /* WELCOME */
    #welcomeScreen {
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    #typingText {
      font-size: 42px;
      font-weight: bold;
      color: cyan;
      text-shadow: 0 0 20px cyan;
    }

    @media (max-width: 768px) {
      #typingText {
        font-size: 32px;
      }
    }

    @media (max-width: 480px) {
      #typingText {
        font-size: 24px;
      }
    }

    /* SUBJECTS */
    .subjects {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    @media (max-width: 768px) {
      .subjects {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        padding: 15px;
      }
    }

    @media (max-width: 480px) {
      .subjects {
        grid-template-columns: 1fr;
        gap: 10px;
        padding: 10px;
      }
    }

    .box {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px 30px;
      border-radius: 15px;
      cursor: pointer;
      box-shadow: 0 0 15px cyan;
      transition: 0.3s;
      text-align: center;
      font-size: 18px;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .box h1 {
      margin: 0;
      font-size: 40px;
      filter: drop-shadow(0 0 10px cyan) contrast(1.2) brightness(1.2);
    }

    @media (max-width: 768px) {
      .box {
        padding: 20px;
        font-size: 16px;
      }
    }

    @media (max-width: 480px) {
      .box {
        padding: 15px;
        font-size: 14px;
      }
    }

    .box:hover {
      transform: scale(1.05);
      box-shadow: 0 0 30px cyan;
    }

    /* CHAPTERS */
    .chapters,
    .content {
      display: none;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    li {
      padding: 10px;
      margin: 8px 0;
      background: #ffffff22;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* Admin Delete Subject Button inside li */
    .delete-subject-btn {
      background: #ff4757;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 12px;
    }

    /* CONTENT */
    .section {
      background: #ffffff22;
      padding: 15px;
      border-radius: 10px;
      margin: 15px 0;
    }

    /* PROGRESS TRACKING STYLES */
    .progress-box {
      background: linear-gradient(135deg, rgba(46, 204, 113, 0.2) 0%, rgba(39, 174, 96, 0.2) 100%);
      padding: 25px;
      border-radius: 12px;
      border: 2px solid cyan;
      box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
    }

    .subj-progress {
      margin-bottom: 20px;
    }

    .subj-progress-title {
      display: flex;
      justify-content: space-between;
      color: cyan;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .progress-bar {
      width: 100%;
      height: 12px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: 8px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #00cec9, #74b9ff);
      border-radius: 6px;
      transition: width 0.5s ease-in-out;
    }

    .progress-details {
      font-size: 13px;
      color: #ccc;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .progress-details span {
      background: rgba(0, 0, 0, 0.3);
      padding: 3px 8px;
      border-radius: 4px;
    }



    /* BUTTON */
    button {
      padding: 12px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background: cyan;
      color: black;
      font-weight: bold;
      font-size: 16px;
      transition: 0.3s;
    }

    button:hover {
      background: #00ffff;
      transform: scale(1.05);
    }

    @media (max-width: 480px) {
      button {
        padding: 10px 15px;
        font-size: 14px;
      }
    }

    /* SEMESTER VIEW WITH MOTIVATION */
    #semesters {
      display: grid !important;
      grid-template-columns: 1fr;
      gap: 20px;
      padding: 20px;
      align-items: start;
    }

    #semesterContainer {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }



    /* DARK AND LIGHT MODE */
    .light {
      background: #f0f4f8;
      /* Soft light background */
      color: #333;
    }

    .light header {
      background: #ffffff;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .light header h2 {
      text-shadow: none;
      color: #0056b3;
    }

    .light .box,
    .light .info-box,
    .light .motivation-box,
    .light .tasks-box {
      background: #ffffff;
      border-color: #d1d5db;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      color: #333;
    }

    .light .box h1 {
      filter: invert(0.8) hue-rotate(180deg) drop-shadow(0 0 5px rgba(0, 0, 0, 0.2));
    }

    .light .box:hover,
    .light .info-box:hover {
      box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
      border-color: #0056b3;
    }

    .light .motivation-box h3,
    .light .progress-box h3,
    .light .info-box h3 {
      color: #0056b3;
      border-bottom-color: #0056b3;
    }

    .light .motivation-box p {
      color: #444;
      text-shadow: none;
    }

    .light .progress-box {
      border-color: #0056b3;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      background: white;
    }

    .light .subj-progress-title {
      color: #0056b3;
    }

    .light .progress-bar {
      background: #e5e7eb;
    }

    .light .progress-details span {
      background: #f0f4f8;
      color: #0056b3;
      border: 1px solid #d1d5db;
    }


    .light h2,
    .light #subjectTitle,
    .light #chapterTitle {
      color: #222;
    }

    .light .section {
      background: #ffffff;
      color: #333;
      border: 1px solid #e5e7eb;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    /* ABOUT & TERMS SECTION */
    .info-section {
      display: block;
      padding: 40px 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .info-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-top: 30px;
    }

    .info-box {
      background: linear-gradient(135deg, rgba(0, 255, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%);
      border: 2px solid cyan;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
      transition: 0.3s;
    }

    .info-box:hover {
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.4);
      transform: translateY(-5px);
    }

    .info-box h3 {
      color: cyan;
      font-size: 24px;
      margin-top: 0;
      margin-bottom: 15px;
      border-bottom: 2px solid cyan;
      padding-bottom: 10px;
    }

    .info-box p {
      font-size: 14px;
      line-height: 1.8;
      color: #ddd;
    }

    .info-box ul {
      list-style: none;
      padding: 0;
      margin: 10px 0;
    }

    .info-box li {
      padding: 8px 0;
      padding-left: 20px;
      position: relative;
      font-size: 13px;
      color: #ccc;
    }

    .info-box li:before {
      content: "‚ñ∏";
      position: absolute;
      left: 0;
      color: cyan;
      font-weight: bold;
    }

    @media (max-width: 768px) {
      .info-container {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .info-box {
        padding: 20px;
      }

      .info-box h3 {
        font-size: 20px;
      }
    }

    /* SEMESTER MOTIVATION & TASKS */
    .semester-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      padding: 20px;
      max-width: 1200px;
      margin: 20px auto;
    }

    .motivation-box,
    .tasks-box {
      background: linear-gradient(135deg, rgba(0, 255, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%);
      border: 2px solid cyan;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
    }

    .motivation-box h3,
    .tasks-box h3 {
      color: cyan;
      font-size: 20px;
      margin-top: 0;
      margin-bottom: 15px;
      text-align: center;
    }

    .motivation-box p {
      font-size: 18px;
      line-height: 1.6;
      color: #fff;
      font-style: italic;
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.4);
      font-weight: 500;
      letter-spacing: 0.5px;
    }

    .task-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .task-list li {
      display: flex;
      align-items: center;
      padding: 12px;
      margin: 8px 0;
      background: #ffffff11;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }

    .task-list li:hover {
      background: #ffffff22;
      transform: translateX(5px);
    }

    .task-list input[type="checkbox"] {
      width: 20px;
      height: 20px;
      margin-right: 12px;
      cursor: pointer;
      accent-color: cyan;
    }

    .task-list li.completed {
      opacity: 0.6;
      text-decoration: line-through;
    }

    .task-list li.completed input[type="checkbox"] {
      accent-color: #00ff00;
    }

    /* PREMIUM NOTES & BOOK */
    .premium-box {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 165, 0, 0.2) 100%);
      border: 2px solid gold;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
    }

    .premium-box:hover {
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
    }

    .premium-box h1 {
      filter: drop-shadow(0 0 10px gold) contrast(1.2) brightness(1.2);
    }

    .locked-option {
      position: relative;
    }

    .locked-option::after {
      content: 'üîí';
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      filter: drop-shadow(0 0 5px gold);
    }

    .light .premium-box {
      background: #fff8e1;
      border-color: #ffc107;
      color: #333;
      box-shadow: 0 4px 6px rgba(255, 193, 7, 0.3);
    }

    .light .premium-box:hover {
      box-shadow: 0 10px 15px rgba(255, 193, 7, 0.5);
    }

    .light .locked-option::after {
      filter: none;
    }

    /* PAYMENT MODAL */
    #paymentModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 2000;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease-in-out;
    }

    .payment-box {
      background: rgba(10, 20, 30, 0.95);
      border: 2px solid gold;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
      max-width: 400px;
      width: 90%;
      max-height: 90vh;
      /* Set maximum height relative to viewport */
      overflow-y: auto;
      /* Enable vertical scrolling */
      position: relative;
    }

    .light .payment-box {
      background: white;
      border-color: #ffc107;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
    }

    .payment-box h2 {
      color: gold;
      margin-top: 0;
    }

    .light .payment-box h2 {
      color: #ff9800;
    }

    .payment-amount {
      font-size: 32px;
      font-weight: bold;
      color: white;
      margin: 15px 0;
    }

    .light .payment-amount {
      color: #333;
    }

    .qr-container img {
      width: 200px;
      height: 200px;
      border-radius: 10px;
      border: 2px solid cyan;
      margin-bottom: 10px;
    }

    .upi-id {
      font-size: 16px;
      color: cyan;
      margin-bottom: 20px;
      letter-spacing: 1px;
    }

    .light .upi-id {
      color: #0056b3;
    }

    .pay-btn-group {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .pay-btn {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 5px;
      transition: 0.3s;
    }

    .gpay-btn {
      background: #ea4335;
      color: white;
    }

    .phonepe-btn {
      background: #5f259f;
      color: white;
    }

    .confirm-pay-btn {
      background: gold;
      color: black;
      width: 100%;
      padding: 12px;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
    }

    .confirm-pay-btn:hover {
      background: #ffcc00;
      box-shadow: 0 0 25px gold;
    }

    .close-modal {
      position: absolute;
      top: 15px;
      right: 15px;
      background: transparent;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
    }

    .light .close-modal {
      color: black;
    }

    /* CONFETTI ANIMATION */
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      background: gold;
      animation: fall linear forwards;
    }

    @keyframes fall {
      to {
        transform: translateY(100vh) rotate(720deg);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }
  </style>
</head>

<body>
  <div id="globalTicker"
    style="background:#ff4757; color:white; padding:8px; font-weight:bold; text-align:center; font-size:14px; display:none;">
    <marquee id="tickerText" scrollamount="5"></marquee>
  </div>

  <!-- Firebase App (the core Firebase SDK) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <!-- Firebase Realtime Database -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <!-- Firebase Analytics -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-analytics.js"></script>

  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCeW3RJPGLgP1uKbN5zKQhQDJ6KTkAhPaY",
      authDomain: "nextgen-6c99e.firebaseapp.com",
      projectId: "nextgen-6c99e",
      storageBucket: "nextgen-6c99e.firebasestorage.app",
      messagingSenderId: "774793697681",
      appId: "1:774793697681:web:6bcf573562be65701c2230",
      measurementId: "G-NESY4XEM9R"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    firebase.analytics();
  </script>

  <!-- SheetJS for Excel Export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <header style="display:none;">
    <div style="display:flex; align-items:center; gap:10px; flex-grow:1;">
      <img src="img1.png" alt="Logo" style="width: 40px; height: 40px; filter: drop-shadow(0 0 5px cyan);">
      <h2 style="font-size: 28px; letter-spacing: 1px; margin: 0; text-align: left; text-shadow: 0 0 10px cyan;">üìö
        NextGen Library</h2>
    </div>
    <div style="display: flex; gap: 10px; align-items: center;">
      <button id="themeToggleBtn" onclick="toggleMode()"
        style="font-size: 20px; padding: 8px 15px; background: transparent; border: none; box-shadow: none; cursor: pointer;"></button>
    </div>
  </header>

  <!-- AUTHENTICATION SCREEN -->
  <div id="loginScreen">
    <div class="login-box">

      <!-- SIGN UP FORM -->
      <div id="signUpForm">
        <img src="img1.png" alt="Logo"
          style="width: 80px; height: 80px; margin-bottom: 10px; filter: drop-shadow(0 0 10px cyan);">
        <h2>üìù NextGen Library Registration</h2>
        <input type="text" id="regName" class="login-input" placeholder="Name (Letters & Spaces only)">
        <input type="number" id="regRoll" class="login-input" placeholder="DDU Roll Number (13 Digits)"
          style="appearance: none; -moz-appearance: textfield;">

        <div style="display: flex; gap: 10px;">
          <select id="regBranch" class="login-input" style="flex: 1;">
            <option value="" disabled selected>Branch</option>
            <option value="BCA">BCA</option>
            <option value="BTECH">BTECH</option>
            <option value="BBA">BBA</option>
          </select>
          <select id="regSection" class="login-input" style="flex: 1;">
            <option value="" disabled selected>Section</option>
            <option value="A1">Section A1</option>
            <option value="A2">Section A2</option>
            <option value="A3">Section A3</option>
            <option value="A4">Section A4</option>
            <option value="A5">Section A5</option>
            <option value="A6">Section A6</option>
            <option value="A7">Section A7</option>
            <option value="A8">Section A8</option>
          </select>
        </div>

        <input type="tel" id="regMobile" class="login-input" placeholder="Mobile Number">

        <button class="login-btn" onclick="handleSignUp()">Sign Up & Enter</button>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
          <p class="auth-toggle" style="margin: 0;">Already have an account? <span
              onclick="toggleAuthMode('login')">Login</span></p>
          <div class="admin-link" onclick="toggleAuthMode('admin')">Admin Login</div>
        </div>
      </div>

      <!-- LOGIN FORM -->
      <div id="loginForm" style="display: none;">
        <img src="img1.png" alt="Logo"
          style="width: 80px; height: 80px; margin-bottom: 10px; filter: drop-shadow(0 0 10px cyan);">
        <h2>üîë NextGen Login</h2>
        <input type="text" id="loginName" class="login-input" placeholder="Name">
        <select id="loginSection" class="login-input">
          <option value="" disabled selected>Section</option>
          <option value="A1">Section A1</option>
          <option value="A2">Section A2</option>
          <option value="A3">Section A3</option>
          <option value="A4">Section A4</option>
          <option value="A5">Section A5</option>
          <option value="A6">Section A6</option>
          <option value="A7">Section A7</option>
          <option value="A8">Section A8</option>
        </select>
        <input type="tel" id="loginMobile" class="login-input" placeholder="Mobile Number">
        <button class="login-btn" onclick="handleLogin()">Log In</button>
        <p class="auth-toggle" style="text-align: right; margin-top: 5px;">Forgot Details? <span
            onclick="recoverDetails()">Click Here</span></p>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
          <p class="auth-toggle" style="margin: 0;">New user? <span onclick="toggleAuthMode('signup')">Sign Up</span>
          </p>
          <div class="admin-link" onclick="toggleAuthMode('admin')">Admin Login</div>
        </div>
      </div>

      <!-- ADMIN LOGIN FORM -->
      <div id="adminLoginForm" style="display: none;">
        <h2>üõ°Ô∏è Admin Access</h2>
        <input type="text" id="adminUser" class="login-input" placeholder="Admin Username">
        <input type="password" id="adminPass" class="login-input" placeholder="Admin Password">
        <button class="login-btn" onclick="handleAdminLogin()"
          style="background: #ff4757; color: white; box-shadow: 0 0 15px rgba(255, 71, 87, 0.5);">Authenticate</button>
        <p class="auth-toggle" style="margin-top: 20px;">Return to <span onclick="toggleAuthMode('login')">Student
            Login</span></p>
      </div>

    </div>
  </div>

  <!-- EDIT PROFILE SCREEN -->
  <div id="editProfileScreen"
    style="display: none; height: 100vh; flex-direction: column; justify-content: center; align-items: center; text-align: center; background: radial-gradient(circle at center, #001f3f, #000); position: fixed; width: 100%; top: 0; left: 0; z-index: 1000;">
    <div class="login-box">
      <h2>‚úèÔ∏è Edit Profile</h2>
      <input type="text" id="editName" class="login-input" placeholder="Name (Letters & Spaces only)">
      <input type="number" id="editRoll" class="login-input" placeholder="DDU Roll Number (13 Digits)"
        style="appearance: none; -moz-appearance: textfield;">

      <div style="display: flex; gap: 10px;">
        <select id="editBranch" class="login-input" style="flex: 1;">
          <option value="BCA">BCA</option>
          <option value="BTECH">BTECH</option>
          <option value="BBA">BBA</option>
        </select>
        <select id="editSection" class="login-input" style="flex: 1;">
          <option value="A1">Section A1</option>
          <option value="A2">Section A2</option>
          <option value="A3">Section A3</option>
          <option value="A4">Section A4</option>
          <option value="A5">Section A5</option>
          <option value="A6">Section A6</option>
          <option value="A7">Section A7</option>
          <option value="A8">Section A8</option>
        </select>
      </div>

      <input type="tel" id="editMobile" class="login-input" placeholder="Mobile Number">

      <button class="login-btn" onclick="saveProfileChanges()" style="margin-bottom: 15px;">üíæ Save Changes</button>
      <button class="login-btn" onclick="closeEditProfile()"
        style="background: transparent; border: 1px solid cyan; color: cyan; box-shadow: none;">‚ùå Cancel</button>
    </div>
  </div>

  <!-- ADMIN DASHBOARD -->
  <div id="adminDashboard">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <h2 style="color: cyan; text-shadow: 0 0 10px cyan;">üõ°Ô∏è Secure Admin Dashboard</h2>
      <div style="display: flex; gap: 10px;">
        <button onclick="exportToExcel()" style="background: #28a745; color: white;">üìä Export to Excel</button>
        <button onclick="adminLogout()" style="background: #ff4757; color: white;">Logout Admin</button>
      </div>
    </div>
    <p>View all registered student data below. This info is protected.</p>
    <div style="overflow-x: auto;">
      <table class="admin-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Roll Number</th>
            <th>Branch</th>
            <th>Section</th>
            <th>Mobile Number</th>
          </tr>
        </thead>
        <tbody id="adminTableBody">
          <!-- Rows injected via JS -->
        </tbody>
      </table>
    </div>

    <!-- ADMIN CONTENT MANAGEMENT SYSTEM -->
    <div id="adminCMS" style="margin-top: 40px; border-top: 1px solid rgba(0,255,255,0.3); padding-top: 20px;">
      <h3 style="color: cyan; text-align: left;">‚úèÔ∏è Manage Course Content</h3>
      <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
        <select id="cmsCourse" class="login-input" style="flex: 1; margin: 0; min-width: 120px;"
          onchange="onAdminCourseChange()">
          <option value="" disabled selected>Course</option>
        </select>
        <select id="cmsBranch" class="login-input" style="flex: 1; margin: 0; min-width: 120px;"
          onchange="onAdminBranchChange()">
          <option value="" disabled selected>Branch</option>
        </select>
        <select id="cmsSemester" class="login-input" style="flex: 1; margin: 0; min-width: 120px;"
          onchange="onAdminSemesterChange()">
          <option value="" disabled selected>Semester</option>
        </select>
        <select id="cmsSubject" class="login-input" style="flex: 1; margin: 0; min-width: 120px;"
          onchange="onAdminSubjectChange()">
          <option value="" disabled selected>Subject</option>
        </select>
        <select id="cmsChapter" class="login-input" style="flex: 1; margin: 0; min-width: 120px;"
          onchange="onAdminChapterChange()">
          <option value="" disabled selected>Chapter</option>
        </select>
      </div>

      <div id="cmsEditor" style="display: none; text-align: left;">
        <label style="color: cyan; font-size: 14px;">üìπ Video URLs (YouTube Embed):</label>
        <div id="cmsVideoContainer"></div>
        <button class="cms-add-btn" onclick="addCMSField('video')">‚ûï Add Video</button>
        <br><br>

        <label style="color: cyan; font-size: 14px;">üìù Study Notes:</label>
        <div id="cmsNotesContainer"></div>
        <button class="cms-add-btn" onclick="addCMSField('notes')">‚ûï Add Note Block</button>
        <br><br>

        <label style="color: cyan; font-size: 14px;">üìÑ PDF URLs (Google Drive Link):</label>
        <div id="cmsPdfContainer"></div>
        <button class="cms-add-btn" onclick="addCMSField('pdf')">‚ûï Add PDF</button>
        <br><br>

        <label style="color: cyan; font-size: 14px;">üìÑ Assignment:</label>
        <div id="cmsAssignmentContainer"></div>
        <button class="cms-add-btn" onclick="addCMSField('assignment')">‚ûï Add Assignment Block</button>
        <br><br>

        <label style="color: cyan; font-size: 14px;">üè† Homework:</label>
        <div id="cmsHomeworkContainer"></div>
        <button class="cms-add-btn" onclick="addCMSField('homework')">‚ûï Add Homework Block</button>
        <br><br>

        <button class="login-btn" onclick="saveAdminContent()"
          style="background: #00e676; color: black; box-shadow: 0 0 15px rgba(0, 230, 118, 0.4);">üíæ Save
          Content</button>
      </div>
    </div>

    <!-- ADMIN SUBJECT MANAGEMENT -->
    <div id="adminSubjectManager"
      style="margin-top: 40px; border-top: 1px solid rgba(0,255,255,0.3); padding-top: 20px;">

      <!-- MANAGE COURSES -->
      <h3 style="color: cyan; text-align: left;">üè¢ Manage Courses</h3>
      <div style="display: flex; gap: 10px; margin-bottom: 25px;">
        <input type="text" id="newCourseName" class="login-input" placeholder="New Course Name (e.g. MCA)"
          style="flex: 2; margin-bottom: 0;">
        <button class="login-btn" onclick="addAdminCourse()"
          style="flex: 1; margin-top: 0; background: #00cec9; color: black;">‚ûï Add Course</button>
      </div>

      <!-- MANAGE SUBJECTS -->
      <h3 style="color: cyan; text-align: left;">üìö Manage Subjects</h3>
      <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
        <select id="subCourse" class="login-input" style="flex: 1; margin: 0; min-width: 120px;"
          onchange="onSubCourseChange()">
          <option value="" disabled selected>Course</option>
        </select>
        <select id="subBranch" class="login-input" style="flex: 1; margin: 0; min-width: 120px;"
          onchange="onSubBranchChange()">
          <option value="" disabled selected>Branch</option>
        </select>
        <select id="subSemester" class="login-input" style="flex: 1; margin: 0; min-width: 120px;"
          onchange="onSubSemesterChange()">
          <option value="" disabled selected>Semester</option>
        </select>
      </div>

      <div id="subEditor" style="display: none; text-align: left;">
        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
          <input type="text" id="newSubjectName" class="login-input" placeholder="New Subject Name"
            style="flex: 2; margin-bottom: 0;">
          <button class="login-btn" onclick="addAdminSubject()"
            style="flex: 1; margin-top: 0; background: #00e676; color: black;">‚ûï Add Subject</button>
        </div>

        <h4 style="color: #ddd;">Existing Subjects</h4>
        <ul id="adminSubjectList" style="list-style: none; padding: 0; max-height: 200px; overflow-y: auto;">
          <!-- Dynamically populated list of subjects -->
        </ul>
      </div>
    </div>

    <!-- ADMIN PREMIUM SETTINGS -->
    <div id="adminPremiumSettings"
      style="margin-top: 40px; border-top: 1px solid rgba(255,215,0,0.5); padding-top: 20px;">
      <h3 style="color: gold; text-align: left;">üíé Premium Payment Settings</h3>

      <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
        <select id="premConfigCourse" class="login-input" style="flex: 1; margin: 0; min-width: 120px;"
          onchange="onAdminPremConfigCourseChange()">
          <option value="" disabled selected>Select Premium Course</option>
          <option value="BCA">BCA</option>
          <option value="BTECH">BTECH</option>
          <option value="BBA">BBA</option>
        </select>
        <select id="premConfigOption" class="login-input" style="flex: 1; margin: 0; min-width: 120px;"
          onchange="onAdminPremConfigOptionChange()">
          <option value="" disabled selected>Select Option</option>
        </select>
      </div>

      <div id="premiumConfigEditor" style="display: none;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div style="display: flex; flex-direction: column; gap: 10px;">
            <label style="color: #ccc; font-size: 14px;">Upload QR Code Image:</label>
            <input type="file" id="premiumQRFile" class="login-input" accept="image/*"
              onchange="previewPremiumQR(event)" style="padding: 5px;">
            <img id="premiumQRPreview" src="" alt="QR Preview"
              style="width: 100px; height: 100px; object-fit: contain; border: 1px solid cyan; border-radius: 5px; display: none;">
          </div>
          <div>
            <label style="color: #ccc; font-size: 14px;">UPI ID:</label>
            <input type="text" id="premiumUPI" class="login-input" placeholder="e.g. 9876543210@ybl">
          </div>
          <div>
            <label style="color: #ccc; font-size: 14px;">Premium Amount ‚Çπ:</label>
            <input type="number" id="premiumAmount" class="login-input" placeholder="e.g. 499">
          </div>
        </div>
        <button class="login-btn" onclick="savePremiumConfig()"
          style="background: gold; color: black; box-shadow: 0 0 15px rgba(255, 215, 0, 0.4); margin-top: 15px;">üíæ Save
          Payment
          Settings</button>
      </div>
    </div>

    <!-- ADMIN PREMIUM CONTENT CMS -->
    <div id="adminPremiumCMS"
      style="margin-top: 40px; border-top: 1px solid rgba(0, 255, 255, 0.3); padding-top: 20px;">
      <h3 style="color: cyan; text-align: left;">üíé Manage Premium Content (PDFs)</h3>
      <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
        <select id="premCmsCourse" class="login-input" style="flex: 1; margin: 0; min-width: 120px;"
          onchange="onPremCourseChange()">
          <option value="" disabled selected>Select Premium Course</option>
          <option value="BCA">BCA</option>
          <option value="BTECH">BTECH</option>
          <option value="BBA">BBA</option>
        </select>
        <select id="premCmsOption" class="login-input" style="flex: 1; margin: 0; min-width: 120px;"
          onchange="onPremOptionChange()">
          <option value="" disabled selected>Select Option</option>
        </select>
      </div>

      <div id="premEditor" style="display: none; text-align: left;">
        <div style="display: flex; gap: 10px; margin-bottom: 20px; align-items: stretch;">
          <input type="text" id="newPremOptionName" class="login-input" placeholder="Create New Option (e.g. MBA Agra)"
            style="flex: 2; margin-bottom: 0;">
          <button class="login-btn" onclick="addPremiumOption()"
            style="flex: 1; margin-top: 0; background: gold; color: black;">‚ûï Add Option</button>
        </div>

        <div style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
          <h4 style="color: gold; margin-top: 0;">Add PDF to Selected Option</h4>
          <input type="text" id="newPremPdfTitle" class="login-input" placeholder="PDF Title (e.g. Chapter 1 Notes)">
          <input type="text" id="newPremPdfLink" class="login-input" placeholder="Google Drive / PDF Link">
          <button class="login-btn" onclick="addPremiumPdf()" style="background: cyan; color: black;">Upload PDF
            Link</button>
        </div>

        <h4 style="color: #ddd;">Existing PDFs in Option</h4>
        <ul id="adminPremPdfList" style="list-style: none; padding: 0; max-height: 200px; overflow-y: auto;">
          <!-- Dynamically populated list of PDFs -->
        </ul>
      </div>
    </div>

    <!-- PENDING PREMIUM APPROVALS -->
    <div id="adminPendingPayments" style="margin-top: 40px; border-top: 1px solid #ff4757; padding-top: 20px;">
      <h3 style="color: #ff4757; text-align: left;">‚è≥ Pending Premium Approvals</h3>
      <div style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 10px; overflow-x: auto;">
        <table style="width: 100%; text-align: left; border-collapse: collapse;">
          <thead>
            <tr style="border-bottom: 1px solid #ff4757;">
              <th style="padding: 10px; color: gold;">Student</th>
              <th style="padding: 10px; color: gold;">Option</th>
              <th style="padding: 10px; color: gold;">UTR</th>
              <th style="padding: 10px; color: gold;">Proof</th>
              <th style="padding: 10px; color: gold;">Action</th>
            </tr>
          </thead>
          <tbody id="pendingPaymentsTableBody">
            <!-- Dynamically populated -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- SITE SETTINGS -->
    <div id="adminSiteSettings"
      style="margin-top: 40px; border-top: 1px solid rgba(0, 255, 255, 0.3); padding-top: 20px; margin-bottom: 40px;">
      <h3 style="color: cyan; text-align: left;">‚öôÔ∏è Advanced Site Settings</h3>
      <div style="display: flex; flex-direction: column; gap: 15px;">
        <div>
          <label style="color: #ccc; font-size: 14px;">Live Scrolling Announcement (Top Ticker):</label>
          <input type="text" id="siteTickerText" class="login-input"
            placeholder="Type announcement here... Leave blank to hide." style="margin-bottom: 0;">
        </div>
        <div>
          <label style="color: #ccc; font-size: 14px;">Welcome Subtitle (under logo):</label>
          <input type="text" id="siteWelcomeText" class="login-input" placeholder="e.g. Your Digital Learning Hub"
            style="margin-bottom: 0;">
        </div>
        <div>
          <label style="color: #ccc; font-size: 14px;">About Us Content:</label>
          <textarea id="siteAboutText" class="login-input" placeholder="Welcome to NextGen Library..."
            style="height: 80px; margin-bottom: 0;"></textarea>
        </div>
      </div>
      <button class="login-btn" onclick="saveSiteSettings()"
        style="background: #28a745; color: white; margin-top: 15px;">üíæ Save Site Settings</button>
    </div>

  </div>

  <!-- WELCOME -->
  <div id="welcomeScreen" style="display:none;">
    <div style="position: absolute; top: 20px; right: 20px;">
      <button onclick="openEditProfile()"
        style="font-size: 14px; padding: 8px 15px; background: rgba(0, 255, 255, 0.2); border: 1px solid cyan; border-radius: 5px; color: cyan; cursor: pointer;">‚úèÔ∏è
        Edit Profile</button>
    </div>
    <img src="img1.png" alt="NextGen Library"
      style="width:250px; height:250px; margin-bottom:20px; filter:drop-shadow(0 0 20px cyan);">
    <h1 id="typingText"></h1>
    <p id="welcomeSubtitle">Your Digital Learning Hub</p>
    <button onclick="enterSite()">Enter Library</button>
  </div>

  <!-- PROGRAMS VIEW WITH INFO -->
  <div id="programsWrapper" style="display:none;">
    <div class="subjects" id="programs">
      <div class="box" onclick="openStudentLevel('course', 'BCA')">üéì BCA</div>
      <div class="box" onclick="openStudentLevel('course', 'BTECH')">üè¢ BTECH</div>
      <div class="box" onclick="openStudentLevel('course', 'BBA')">üíº BBA</div>
      <div class="box premium-box" onclick="openPremiumHub()">
        <h1>üíé</h1>Premium Notes & Book
      </div>
    </div>

    <!-- ABOUT & TERMS SECTION -->
    <div class="info-section">
      <div class="info-container">
        <div class="info-box">
          <h3>üìö About NextGen Library</h3>
          <div id="aboutUsContent">
            <p>Welcome to NextGen Library, your premier digital learning platform designed for modern students. We
              believe
              that quality education should be structured, accessible, and interactive.</p>
            <p>Our platform integrates:</p>
            <ul>
              <li>High-quality Video Lectures</li>
              <li>Meticulously curated Study Notes</li>
              <li>Rigorous Assignments & Practice</li>
              <li>Comprehensive Homework Guidance</li>
              <li>Instant Doubt Resolution Support</li>
            </ul>
            <p>Whether you're tackling daily challenges or seeking clarity, we provide the tools necessary for academic
              excellence and personal growth.</p>
          </div>
        </div>

        <div class="info-box">
          <h3>‚öñÔ∏è Terms & Conditions</h3>
          <ul>
            <li><strong>Usage Rights:</strong> All content is for educational purposes only</li>
            <li><strong>Intellectual Property:</strong> Content owned by NextGen Library and respective creators</li>
            <li><strong>User Responsibility:</strong> Students must use resources ethically and legally</li>
            <li><strong>Account Security:</strong> Users are responsible for account confidentiality</li>
            <li><strong>Content Accuracy:</strong> We strive for accuracy but don't guarantee completeness</li>
            <li><strong>Limitation:</strong> Not liable for indirect damages or service interruptions</li>
            <li><strong>Updates:</strong> Terms may be updated. Continued use implies acceptance</li>
            <li><strong>Support:</strong> Contact us for queries or concerns regarding any content</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- DYNAMIC NAVIGATION SECTION -->
  <div id="dynamicNavSection" style="display:none; text-align:center;">
    <button id="dynamicNavBackBtn" onclick="goBackDynamicNav()"
      style="margin-bottom:20px; padding: 12px 20px; font-size:16px;">‚¨Ö Back</button>
    <div id="dynamicNavContainer" class="subjects"></div>
  </div>

  <!-- PREMIUM HUB NAVIGATION SECTION -->
  <div id="premiumNavSection" style="display:none; text-align:center;">
    <button onclick="goBackFromPremium()" style="margin-bottom:20px; padding: 12px 20px; font-size:16px;">‚¨Ö
      Back</button>
    <h2 style="color: gold; text-shadow: 0 0 10px gold; font-size: 28px;">üíé Premium Notes & Book</h2>
    <p style="color: #ddd;">Unlock exclusive exam-oriented materials!</p>
    <div id="premiumCoursesContainer" class="subjects">
      <!-- Injected dynamically or statically -->
      <div class="box" onclick="showPremiumOptions('BCA')">
        <h1>üéì</h1>Premium BCA
      </div>
      <div class="box" onclick="showPremiumOptions('BTECH')">
        <h1>üè¢</h1>Premium BTECH
      </div>
      <div class="box" onclick="showPremiumOptions('BBA')">
        <h1>üíº</h1>Premium BBA
      </div>
    </div>
    <div id="premiumOptionsContainer" class="subjects" style="display:none;">
      <!-- Injected dynamically based on selection -->
    </div>

    <div id="premiumContentContainer"
      style="display:none; text-align:left; max-width: 800px; margin: 0 auto; padding: 20px;">
      <button onclick="goBackToPremiumOptions()"
        style="margin-bottom:20px; padding: 8px 15px; font-size:14px; background: rgba(255,215,0,0.2); border: 1px solid gold; color: gold;">‚¨Ö
        Back to Options</button>
      <h3 id="activePremiumOptionTitle" style="color: gold; text-shadow: 0 0 10px gold; font-size: 24px;">Option Title
      </h3>
      <div id="premiumPdfsGrid"
        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
        <!-- PDFs injected here -->
      </div>
    </div>
  </div>

  <!-- PAYMENT MODAL -->
  <div id="paymentModal">
    <div class="payment-box">
      <button class="close-modal" onclick="closePaymentModal()">‚úñ</button>
      <h2>Unlock Premium Content</h2>
      <p style="color: #ccc;" id="paymentDesc">Complete payment to access this section indefinitely.</p>
      <div class="payment-amount" id="paymentAmountDisplay">‚Çπ0</div>

      <div class="qr-container">
        <img id="paymentQRDisplay" src="" alt="Scan QR Code to Pay" style="display: none;">
      </div>
      <div class="upi-id" id="paymentUPIDisplay">UPI ID: Not Set</div>

      <div class="pay-btn-group">
        <button class="pay-btn gpay-btn" onclick="payWithUpiApp('gpay')">Pay via GPay</button>
        <button class="pay-btn phonepe-btn" onclick="payWithUpiApp('phonepe')">Pay via PhonePe</button>
      </div>

      <div style="text-align: left; margin: 15px 0;">
        <label style="color: #ccc; font-size: 14px;">12-Digit UTR / Transaction ID (Mandatory):</label>
        <input type="number" id="paymentUtrInput" class="login-input" placeholder="Enter exactly 12 digits"
          style="margin-bottom: 10px;">

        <label style="color: #ccc; font-size: 14px;">Upload Payment Screenshot (Required):</label>
        <input type="file" id="paymentScreenshotInput" class="login-input" accept="image/*" style="padding: 5px;"
          onchange="previewPaymentScreenshot(event)">
        <img id="paymentScreenshotPreview" src="" alt="Screenshot"
          style="width: 100%; max-height: 150px; object-fit: contain; border: 1px solid cyan; border-radius: 5px; display: none; margin-top: 10px;">
      </div>

      <button class="confirm-pay-btn" onclick="confirmPremiumPayment()">Submit for Verification</button>
    </div>
  </div>

  <!-- MOTIVATION SECTION -->
  <div id="semesterMotivationSection" style="display:none;">
    <div class="semester-section">
      <div class="motivation-box">
        <h3>‚ú® Daily Motivation</h3>
        <p id="motivationText">"Success is not final, failure is not fatal: It is the courage to continue that counts.
          Keep pushing your
          limits and remember, every expert was once a beginner. Your hard work today shapes your tomorrow. Focus on
          the
          process, and the results will follow!"</p>
      </div>

      <div class="progress-box" id="progressDashboard">
        <h3>üìä Analytics & Progress Tracking</h3>
        <p style="color: #aaa; font-size: 14px; margin-bottom: 15px;">Automatically tracking your completed videos,
          PDFs, and assignments across all subjects in this semester.</p>
        <div id="progressContent">
          <!-- Dynamically Injected Progress Bars -->
        </div>
      </div>
    </div>
  </div>

  <!-- CHAPTERS -->
  <div class="chapters" id="chapters" style="display:none;">
    <button onclick="goBackToSubjects()" style="margin-bottom:15px; font-size:16px;">‚¨Ö Back to Subjects</button>
    <h2 id="subjectTitle"></h2>
    <ul id="chapterList"></ul>
  </div>

  <!-- CONTENT -->
  <div class="content" id="content">
    <button onclick="goBackChapter()" style="margin-bottom:15px; font-size:16px;">‚¨Ö Back</button>
    <h2 id="chapterTitle"></h2>

    <div class="section" id="videoSection">
      üìπ Video(s):<br>
      <div id="videoContainer" style="display: flex; flex-direction: column; gap: 15px; margin-top: 10px;"></div>
    </div>

    <div class="section" id="notesSection">
      üìù Notes:
      <div id="notesText" style="margin-top: 10px;"></div>
    </div>

    <div class="section" id="pdfSection" style="display:none;">
      üìÑ PDF Notes:<br>
      <div id="pdfContainer" style="display: flex; flex-direction: column; gap: 15px; margin-top: 10px;"></div>
    </div>

    <div class="section" id="assignmentSection">
      üìÑ Assignment:
      <div id="assignmentText" style="margin-top: 10px;"></div>
    </div>

    <div class="section" id="homeworkSection">
      üè† Homework:
      <div id="homeworkText" style="margin-top: 10px;"></div>
    </div>

    <!-- AI TUTOR CHATBOT -->
    <div id="aiTutorWidget" style="position: fixed; bottom: 30px; right: 30px; z-index: 1000;">
      <button id="aiTutorBtn" onclick="toggleChat()"
        style="background: cyan; color: black; border: none; border-radius: 50%; width: 60px; height: 60px; font-size: 30px; box-shadow: 0 0 15px cyan; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: transform 0.3s;"
        onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">ü§ñ</button>

      <div id="aiChatBox"
        style="display: none; position: absolute; bottom: 75px; right: 0; width: 350px; background: rgba(0, 15, 30, 0.95); border: 1px solid cyan; border-radius: 10px; box-shadow: 0 0 20px cyan; overflow: hidden; flex-direction: column; z-index: 1001;">
        <div
          style="background: cyan; color: black; padding: 12px; font-weight: bold; display: flex; justify-content: space-between; align-items: center;">
          <span style="font-size: 16px;">ü§ñ Gemini AI Tutor</span>
          <button onclick="toggleChat()"
            style="background: transparent; border: none; font-size: 18px; cursor: pointer; color: black; font-weight: bold;">‚úñ</button>
        </div>

        <div id="aiChatHistory"
          style="height: 320px; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; font-size: 14px;">
          <div
            style="align-self: flex-start; background: rgba(0, 255, 255, 0.1); padding: 10px 14px; border-radius: 12px; border-bottom-left-radius: 0; max-width: 85%; border: 1px solid rgba(0, 255, 255, 0.3); color: white; line-height: 1.4;">
            Hello! I'm your AI Assistant. Ask me any doubt related to your studies, assignments, or
            homework!
          </div>
        </div>

        <div
          style="display: flex; gap: 8px; padding: 12px; border-top: 1px solid rgba(0, 255, 255, 0.3); background: rgba(0, 5, 15, 0.9);">
          <input type="text" id="aiChatInput" placeholder="Ask a doubt..."
            style="flex: 1; padding: 10px; border-radius: 5px; border: 1px solid cyan; background: rgba(0, 255, 255, 0.05); color: white; outline: none;"
            onkeypress="if(event.key === 'Enter') sendChatMessage()">
          <button onclick="sendChatMessage()"
            style="background: cyan; color: black; border: none; border-radius: 5px; padding: 0 15px; font-weight: bold; cursor: pointer; transition: background 0.3s;"
            onmouseover="this.style.background='#00cccc'" onmouseout="this.style.background='cyan'">Send</button>
        </div>
      </div>
    </div>
  </div>

  <footer
    style="text-align: center; padding: 20px; margin-top: 40px; border-top: 1px solid rgba(0, 255, 255, 0.3); padding-bottom: 90px; color: #ccc;">
    Copyright ¬© 2026 NextGen Library Made by @mr_insaan_kumar
  </footer>

  <script>
    /* AUTO TYPING */
    let text = "WELCOME TO NEXTGEN LIBRARY";
    let i = 0;
    function typing() {
      if (i < text.length) {
        document.getElementById("typingText").innerHTML += text.charAt(i);
        i++;
        setTimeout(typing, 100);
      }
    }
    typing();

    /* DATA */
    let oldData = {
      Math: {
        "UNIT 1: Set theory. Relations and Functions": {
          video: "https://www.youtube.com/embed/LK4TtZ_vkeM?si=rF8rcCWCYnUP52z1",
          notes: "Introduction to sets, subsets, operations.",
          pdf: "https://drive.google.com/file/d/15BlIRvpsrBmS-2566uqgrcNJKWINMWOp/view?usp=drive_link",
          assignment: "Solve 10 problems from Set Theory.",
          homework: "Revise union & intersection."
        },
        "UNIT 2: Permutation, Combination and Algebraic System:": {
          video:
            "https://www.youtube.com/embed/yurSCPPloMs?si=lLz2WObc1MDPpbD2",
          notes: "Graphs, trees, properties.",
          pdf: "https://drive.google.com/file/d/1Hf9igdkNSUthYv4Ow6aKiQl3hHusU3dW/view?usp=drive_link",
          assignment: "Draw 5 graphs.",
          homework: "Study tree traversal."
        },
        "UNTI 3: Algebra of Logic:": {
          video: "https://www.youtube.com/embed/l5Vt5bzkLK0?si=G3PrWBLUvQx_3aIT",
          notes: "Boolean algebra, logical operators, truth tables.",
          pdf: "",
          assignment: "Solve 8 problems on propositional calculus.",
          homework: "Study De Morgan's laws."
        },
        "UNIT 4: Recursion and recurrence:": {
          video: "https://www.youtube.com/embed/2ii8mCFXj88?si=idXwvor_pEm4jySM",
          notes: "Lattice structures, Boolean operations, applications.",
          pdf: "",
          assignment: "Design a Boolean circuit.",
          homework: "Revise lattice properties."
        },
        "UNIT 5: Graph and Trees:": {
          video: "https://www.youtube.com/embed/la7b2jWFuhQ?si=7AeONZ9vcfbJu8D7",
          notes: "Graph traversal, connectivity, shortest paths.",
          pdf: "",
          assignment: "Solve graph problems.",
          homework: "Study BFS and DFS algorithms."
        }
      },

      Accounting: {
        "UNIT 1: Introduction to Accounting": {
          video: "https://www.youtube.com/embed/B0jZsLg8pks?si=PCIH4MLVJ09W8cBf",
          notes: "Meaning, Characteristics, Purposes and Limitations; Concepts, Convention and Generally Accepted Accounting Principles.",
          pdf: "https://drive.google.com/file/d/1urySIm4IyaEfc5KWraOTnL1bsAf9koOt/view?usp=drive_link",
          assignment: "Prepare journal entries.",
          homework: "Revise rules."
        },
        "UNIT 2:  Financial Accounting: ": {
          video: "https://www.youtube.com/embed/5pmh4cl9GKY?si=Wm9xem8uGXS_a86H",
          notes: " Double Entry Framework, Basic Concept of Journal, Ledgers-Purchase Book, Sales Book, Cash Book; Trading and Profit & Loss Account, Balance Sheet",
          pdf: "https://drive.google.com/file/d/1Z-BAht5KXnw5V4wlT1QIVqsYUcnoZJwi/view?usp=drive_link",
          assignment: "Prepare journal and ledger entries.",
          homework: "Study golden rules of accounting."
        },
        "UNIT 3: Management Accounting:": {
          video: "https://www.youtube.com/embed/gnRmh4OI3pw?si=ilYJCzzw4ZaOG8jG",
          notes: "Nature, Scope, Advantage and Limitations; Differences between Management Accounting and Financial Accounting.",
          pdf: "",
          assignment: "Prepare complete financial statements.",
          homework: "Verify trial balance."
        },
        "UNIT 4: Raising Funds:": {
          video: "https://www.youtube.com/embed/82u1qyHBMQ4?si=oygKhomi2yJ7BYjq",
          notes: "Sources of Raising Funds, Simple Treatment to Issue of Shares, Forfeiture of Shares and Reissue of Forfeited Shares.",
          pdf: "",
          assignment: "Calculate depreciation and adjustments.",
          homework: "Study adjustment process."
        },
        "UNIT 5:  Computer Application:": {
          video: "https://www.youtube.com/embed/8Haz0xLfcbA?si=rzLQu9kw1WA2DMHx",
          notes: " Role of Computers in Accounting, Software Packages for Accounting",
          pdf: "",
          assignment: "Analyze financial statements.",
          homework: "Study key financial ratios."
        }
      },

      Dcld: {
        "DCLD - UNIT 1: Number Systems": {
          video: "https://www.youtube.com/embed/MxjJqq3B6JU?si=6rhZmrISZh_PnFVu",
          notes: "Decimal, Binary, Octal, Hexadecimal number system, inter conversion between different number systems, different codes, gray code, ASCII code, Floating point numbers.",
          pdf: "",
          assignment: "Convert numbers between different bases.",
          homework: "Study number system conversions."
        },
        "DCLD - UNIT 2: Logic Gates and Boolean Algebra": {
          video: "https://www.youtube.com/embed/EW_2MhFu7tE?si=ti8E8NYs7Dtw4pHH",
          notes: "Elements and functions of digital Logic gates, Gate propagation delay time, logic gates applications. Boolean algebra: Boolean operations, SOP and POS forms and simplification using Karnaugh maps, Realization of expressions using universal logic gates.",
          pdf: "",
          assignment: "Simplify Boolean expressions using K-maps.",
          homework: "Study Boolean theorems."
        },
        "DCLD - UNIT 3: Combinational logical circuits": {
          video: "https://www.youtube.com/embed/pHNbm-4reIc?si=BcNoKtnKTlYu7e90",
          notes: "Design of Binary Adder- half and full, Serial, Parallel, Carry look ahead adder. Full subtracter, code converters, MUX and DEMUX, encoders and decoders, seven segment decoder.",
          pdf: "",
          assignment: "Design combinational logic circuits.",
          homework: "Study gate implementations."
        },
        "DCLD - UNIT 4: Sequential logic circuits: ": {
          video: "https://www.youtube.com/embed/v0pxOfTg18Y?si=4nq0hPKMPrurDPIj",
          notes: "Latches, key debouncer, Flip flop: SR, J-K, D, T, Master slave J-K, flipflops with preset and clear . Counters; Binary counter, synchronous counter, mod-10 counter, Generation of control signals; Controlled counter; Up-down counter, Shift register, Parity generator or checker, Synchronization of an asynchronous pulse.",
          pdf: "",
          assignment: "Design sequential circuits.",
          homework: "Study flip-flop types."
        },
        "DCLD - UNIT 5:  Microprocessor:": {
          video: "https://www.youtube.com/embed/SBh6dJMM6AI?si=5HwK09d1CBVzUZ6z",
          notes: "Architecture of a basic microcomputer, some general microprocessor system concepts: I/O ports and buses, internal architecture of a microprocessor, Microprocessor fetches, decode, execute cycle memory mapped and I/O mapped ports, I/O controls.",
          pdf: "",
          assignment: "Implement digital devices.",
          homework: "Study device applications."
        },
      },

      Oops: {
        "OOPS - UNIT 1: Principles of Object Oriented Programming (OOP)": {
          video: "https://www.youtube.com/embed/mlIUKyZIUUU?si=SBp5sE2BdgTR8UaY",
          notes: "Basic Concepts of OOP, Comparison of procedural programming and OOP, Advantages of OOP, OOP Languages, Definitions: .Class, Objects, Concepts of inheritance and encapsulation, Operator overloading, Dynamic binding. Over view of OOP using C++, Basic Program construction: main and functions, Program statements, class declaration, comments++ compilation.",
          pdf: "",
          assignment: "Write simple C++ program with classes.",
          homework: "Homework 1 (1) Define low-level, mid-level and high-level languages , (2) Write applications of OOP concepts. Homework 2 (1) Explain how namespace and header files differ from each other using real-life examples. (2) Why is procedural programming unsuitable for large-scale software systems? Explain in depth. (3) Homework 3 (1) Write the difference between function prototype and function declaration with syntax. (2) Explain the difference between class and structure. Write a small code to explain the same."
        },
        "OOPS - UNIT 2: Elements of C++ Language": {
          video: "https://www.youtube.com/embed/TOG6xCEJU3M?si=2lA-jZb7wHUhh1j7",
          notes: "Tokens and identifiers: Character set and symbols, Keywords. C++, identifiers. Variables and constants. Data Types: Basic data types, Arrays and strings, User defined data types; Operators, type conversions and type cast operators, Console I/O : cin, cout functions, Control statements: The if statement, if else; else.... if: switch statements, Loops: for and while do statements, Break, continue, go to, Functions Simple functions: Declaration of functions. Calling functions, Function definition, Passing arguments and returning values: Passing constants and variables, Pass by value. Return statement, types of functions, Passing and returning structure variables, Inline functions, Default arguments, returning by reference, pointers.",
          pdf: "",
          assignment: "Create classes with constructors and destructors.",
          homework: "Study access specifiers."
        },
        "OOPS - UNIT 3:  Classes and Objects": {
          video: "https://www.youtube.com/embed/YNuFnhRMoVs?si=zBd253Sg6HEmRzq-",
          notes: "Declaration of classes and objects in C++, Class definition. Declaration of members, objects as date time, Objects as function arguments. Array of objects, Returning objects from function, Structures and classes. Basic constructors, Parameterized constructors. Constructors with default arguments. Dynamic initialization of objects, use of copy constructor, shallow copying and deep copying, Dynamic constructors. Destructors, constraints on constructors and destructors.",
          pdf: "",
          assignment: "Create derived classes with inheritance.",
          homework: "Study inheritance types."
        },
        "OOPS - UNIT 4:  Operator Overloading": {
          video: "https://www.youtube.com/embed/0QjDxmSVryU?si=KeuZ3RawSubAmCWG",
          notes: "Overloading unary operators: Operator keyword, Arguments and return values, Laminations of increment operators, overloading binary operators. Arithmetic operators Examples: Addition of polar coordinates and concatenation of strings Multiple overloading, Comparison operators, Arithmetic assignment operators. Data and type conversions: Conversion between basic types, Conversion between objects and basic types, conversion between objects of different classes, Constraints on type conversion",
          pdf: "",
          assignment: "Implement polymorphism examples.",
          homework: "Study virtual functions."
        },
        "OOPS - UNIT 5: Derived Classes and Inheritance": {
          video: "https://www.youtube.com/embed/7ZfEp71tIec?si=ch_z8CDdZsAacdFW",
          notes: "Derived, classes and base class: Defining a derived class, accessing the bases class members, the protected access specifier, specifer. Derived class constructors. Overriding the member functions, Class hierarchies: Abstract base class. Inheritance: Public and private inheritance. Types of Inheritance single level, multi level, multiple, hybrid etc., virtual function, stream classes.",
          pdf: "",
          assignment: "Handle exceptions in C++ programs.",
          homework: "Study STL containers."
        }
      },

      Labwork: {
        "L1": { notes: "Lab 1", pdf: "https://drive.google.com/file/d/1i0CEGHhiHYnZZ7ChWoMI_QQIlDh_wElA/view?usp=drive_link" },
        "L2": { notes: "Lab 2", pdf: "https://drive.google.com/file/d/1zolBnOeqZ8nFpRAaWCresFFMEF_RO9H3/view?usp=drive_link" },
        "L3": { notes: "Lab 3", pdf: "https://drive.google.com/file/d/1XDM_QariM46DrngARJyAyJE3wMC1trUT/view?usp=drive_link" },
        "L4": { notes: "Lab 4", pdf: "https://drive.google.com/file/d/1s0haqXOUyHbgKLv9482R6e5iQ30X8T3g/view?usp=drive_link" },
        "L5": { notes: "Lab 5", pdf: "https://drive.google.com/file/d/17VEQ8xkqd8GE-4L2CqCWoYD7fl-mSN8M/view?usp=drive_link" },
        "L6": { notes: "Lab 6", pdf: "https://drive.google.com/file/d/1v6Xe1dcACGTX5uT9jBYpEFvUWh3Sak3p/view?usp=drive_link" },
        "L7": { notes: "Lab 7", pdf: "https://drive.google.com/file/d/1jekV2UHtKTpcBkuZRGZjKceM5XXy1NAk/view?usp=drive_link" },
        "L8": { notes: "Lab 8", pdf: "https://drive.google.com/file/d/1IDVA0Yb-PzDqhMyGMo881HJjx4VVaRce/view?usp=drive_link" },
        "L9": { notes: "Lab 9", pdf: "https://drive.google.com/file/d/1VmSM4IQVXO8Wq_Gfmc_MA31MFTFEwfeZ/view?usp=drive_link" },
        "L10": { notes: "Lab 10", pdf: "https://drive.google.com/file/d/1x_DqpHKEe7VFFCSbbPDziQU4CmqV5h_9/view?usp=drive_link" },
        "L11": { notes: "Lab 11", pdf: "https://drive.google.com/file/d/11qvX83gzQ9-vtTc66T3-_h51b8PcHCur/view?usp=drive_link" },
        "L12": { notes: "Lab 12", pdf: "https://drive.google.com/file/d/1I-RJ3UBs9xRtrCPfUFzAixZ9440mWXKI/view?usp=drive_link" },
        "L13": { notes: "Lab 13", pdf: "https://drive.google.com/file/d/1tWpaL9j9XSIaYzeHNHJJuhDdAP-WX-L3/view?usp=drive_link" },
        "L14": { notes: "Lab 14", pdf: "https://drive.google.com/file/d/1K7_9X1Rnl1qNEaPW4jOFzwkm4455cWCO/view?usp=drive_link" },
        "L15": { notes: "Lab 15", pdf: "https://drive.google.com/file/d/1s5GkA6oqan2EZRZ8xru1Civ_Ce25rP2R/view?usp=drive_link" },
        "L16": { notes: "Lab 16", pdf: "https://drive.google.com/file/d/1WsjzxsOjacvIw-dNhSgySGavNgZfhlf4/view?usp=drive_link" },
        "L17": { notes: "Lab 17", pdf: "https://drive.google.com/file/d/1l7xrvtM0HBJAlNSBcBSC4UjZ8ffTFsNV/view?usp=drive_link" },
        "L18": { notes: "Lab 18", pdf: "https://drive.google.com/file/d/19I44HsJlFwcteidEEm57qO-ezsJcK3Cp/view?usp=drive_link" },
        "L19": { notes: "Lab 19", pdf: "" },
        "L20": { notes: "Lab 20", pdf: "https://drive.google.com/file/d/1ZAp9brogxL2H7P6tM0y6w7tdyn0BWdq2/view?usp=drive_link" },
        "L21": { notes: "Lab 21", pdf: "https://drive.google.com/file/d/1my2W98iS59W8BbG5QU1k8J_kQx14LhsT/view?usp=drive_link" },
        "L22": { notes: "Lab 22", pdf: "https://drive.google.com/file/d/1LATPKKK-0-6o8qWeoykRrfVQsGc5K_G6/view?usp=drive_link" },
        "L23": { notes: "Lab 23", pdf: "https://drive.google.com/file/d/1L-tmZcnLtvm0a3C09tovTigK0dSF0VnT/view?usp=drive_link" },
        "L24": { notes: "Lab 24", pdf: "https://drive.google.com/file/d/1mV_LEIH7YjlzhYtJOsWQrjuGAhfeqprT/view?usp=drive_link" },
        "L25": { notes: "Lab 25", pdf: "https://drive.google.com/file/d/1JQhIymezV4WfcdepiczEx929_nnkEp1M/view?usp=drive_link" },
        "L26": { notes: "Lab 26", pdf: "" },
        "L27": { notes: "Lab 27", pdf: "" },
        "L28": { notes: "Lab 28", pdf: "" },
        "L29": { notes: "Lab 29", pdf: "" },
        "L30": { notes: "Lab 30", pdf: "" },
        "L31": { notes: "Lab 31", pdf: "" },
        "L32": { notes: "Lab 32", pdf: "" },
        "L33": { notes: "Lab 33", pdf: "" },
        "L34": { notes: "Lab 34", pdf: "" },
        "L35": { notes: "Lab 35", pdf: "" },
        "L36": { notes: "Lab 36", pdf: "" },
        "L37": { notes: "Lab 37", pdf: "" },
        "L38": { notes: "Lab 38", pdf: "" },
        "L39": { notes: "Lab 39", pdf: "" },
        "L40": { notes: "Lab 40", pdf: "" }
      },

      ComputerSkill: {
        "UNIT 1: Introduction to Computers": {
          video: "https://www.youtube.com/embed/agaLaSafbwc?si=2OQLr54YVYxY93cr",
          notes: "Computer basics, hardware components, operating systems.",
          pdf: "",
        },
      },

      CommunicationSkill: {
        "UNIT 1: Introduction to Communication": {
          video: "https://www.youtube.com/embed/99W9-1I66Jw?si=oYHcAqt1irSsG2sq",
          notes: "Communication process, types of communication, importance.",
          pdf: "",

        },
        "UNIT 2: Written Communication": {
          video: "https://www.youtube.com/embed/dQw4w9WgXcQ",
          notes: "Business writing, emails, reports, documentation skills.",
          pdf: "",

        },
        "UNIT 3: Verbal Communication": {
          video: "https://www.youtube.com/embed/dQw4w9WgXcQ",
          notes: "Listening skills, speaking techniques, presentation skills.",
          pdf: "",
          assignment: "",
          homework: ""
        },
        "UNIT 4: Non-Verbal Communication": {
          video: "https://www.youtube.com/embed/dQw4w9WgXcQ",
          notes: "Body language, gestures, facial expressions, tone of voice.",
          pdf: "",

        },
        "UNIT 5: Interpersonal and Professional Communication": {
          video: "https://www.youtube.com/embed/dQw4w9WgXcQ",
          notes: "Teamwork, conflict resolution, professional etiquette.",
          pdf: "",

        }
      }
    };

    let allSubjects = {
      "Discrete Maths": oldData.Math,
      "Accounting": oldData.Accounting,
      "Digital Logic": oldData.Dcld,
      "C++ Programming": oldData.Oops,
      "Lab Work": oldData.Labwork,
      "Computer Skills": oldData.ComputerSkill,
      "Communication": oldData.CommunicationSkill,
      "Important Qs": oldData.QuestionPractice
    };

    let defaultData = {
      "BTECH": { "CSE": {}, "ECE": {}, "ME": {}, "CE": {} },
      "BCA": { "DDU": {}, "AKTU": {} },
      "BBA": { "DDU": {}, "AKTU": {} }
    };

    for (let course in defaultData) {
      for (let branch in defaultData[course]) {
        let maxSem = (course === "BTECH") ? 8 : 6;
        for (let i = 1; i <= maxSem; i++) {
          defaultData[course][branch][i] = JSON.parse(JSON.stringify(allSubjects));
        }
      }
    }

    let data = JSON.parse(localStorage.getItem("courseData")) || defaultData;
    let isRecoveringMode = false;
    let currentUserMobile = "";

    // CHECK PERSISTENT LOGIN ON LOAD
    window.onload = function () {
      loadSiteSettings();
      let activeUser = localStorage.getItem("activeSessionMobile");
      let expTime = localStorage.getItem("activeSessionExp");
      if (activeUser && expTime && Date.now() < parseInt(expTime)) {
        database.ref('users/' + activeUser).once('value').then((snapshot) => {
          let userData = snapshot.val();
          if (userData) {
            currentUserMobile = activeUser;
            document.getElementById("loginScreen").style.display = "none";
            document.getElementById("welcomeScreen").style.display = "flex";
            document.querySelector("#welcomeScreen p").innerText += `\nWelcome back, ${userData.name}!`;

            // Backwards compatibility sync if needed
            localStorage.setItem(activeUser, JSON.stringify(userData));
          }
        });
      } else {
        // Clear expired session if any
        localStorage.removeItem("activeSessionMobile");
        localStorage.removeItem("activeSessionExp");
      }
    };

    /* AUTHENTICATION FUNCTIONS */

    function toggleAuthMode(mode) {
      document.getElementById('signUpForm').style.display = 'none';
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('adminLoginForm').style.display = 'none';

      if (mode === 'login') {
        document.getElementById('loginForm').style.display = 'block';
      } else if (mode === 'signup') {
        document.getElementById('signUpForm').style.display = 'block';
      } else if (mode === 'admin') {
        document.getElementById('adminLoginForm').style.display = 'block';
      }
    }

    // ADMIN FUNCTIONS
    function handleAdminLogin() {
      let user = document.getElementById("adminUser").value.trim();
      let pass = document.getElementById("adminPass").value.trim();

      // Default basic credentials for this demo
      if (user === "admin" && pass === "admin123") {
        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("adminDashboard").style.display = "block";
        loadAdminData();
        renderPendingPayments();
      } else {
        alert("Invalid Admin Credentials!");
      }
    }

    function adminLogout() {
      document.getElementById("adminDashboard").style.display = "none";
      document.getElementById("loginScreen").style.display = "flex";
      toggleAuthMode('admin');
      document.getElementById("adminUser").value = "";
      document.getElementById("adminPass").value = "";
    }

    /* PENDING PAYMENTS ADMIN LOGIC */
    function renderPendingPayments() {
      let tbody = document.getElementById("pendingPaymentsTableBody");
      tbody.innerHTML = "<tr><td colspan='5' style='padding: 15px; text-align: center; color: cyan;'>Loading...</td></tr>";

      database.ref('pendingPayments').on('value', snap => {
        tbody.innerHTML = "";
        let pendingData = snap.val() || {};
        let pendingArr = Object.values(pendingData);
        let pendingOnly = pendingArr.filter(req => req.status === "pending");

        if (pendingOnly.length === 0) {
          tbody.innerHTML = "<tr><td colspan='5' style='padding: 15px; text-align: center; color: #aaa;'>No pending Premium approvals.</td></tr>";
          return;
        }

        pendingOnly.forEach(req => {
          let tr = document.createElement("tr");
          tr.style.borderBottom = "1px solid rgba(255,255,255,0.1)";
          tr.innerHTML = `
            <td style="padding: 10px;">${req.name}<br><small style="color:cyan;">${req.mobile}</small></td>
            <td style="padding: 10px;">${req.itemKey.replace('_', ' - ')}</td>
            <td style="padding: 10px; font-family: monospace;">${req.utr}</td>
            <td style="padding: 10px;">
              <button class="login-btn" onclick="viewScreenshot('${req.id}')" style="background: cyan; color: black; padding: 5px 10px; margin: 0; font-size: 12px;">üñºÔ∏è View Proof</button>
            </td>
            <td style="padding: 10px; display: flex; gap: 5px;">
              <button class="login-btn" onclick="approvePayment('${req.id}', '${req.mobile}', '${req.itemKey}')" style="background: #28a745; color: white; padding: 5px 10px; margin: 0; font-size: 12px;">‚úÖ Approve</button>
              <button class="login-btn" onclick="rejectPayment('${req.id}')" style="background: #ff4757; color: white; padding: 5px 10px; margin: 0; font-size: 12px;">‚ùå Reject</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      });
    }

    function viewScreenshot(reqId) {
      database.ref('pendingPayments/' + reqId).once('value').then(snap => {
        let req = snap.val();
        if (req && req.screenshot) {
          let win = window.open("");
          win.document.write(`<img src="${req.screenshot}" style="max-width:100%; display:block; margin:auto;" />`);
        } else {
          alert("Screenshot not available.");
        }
      });
    }

    function approvePayment(reqId, mobile, itemKey) {
      if (confirm("Are you sure you want to approve this payment and grant access?")) {
        // Set premiumUnlocked inside user's node
        database.ref(`users/${mobile}/premiumUnlocked/${itemKey}`).set(true).then(() => {
          // Remove the pending request entirely
          return database.ref('pendingPayments/' + reqId).remove();
        }).then(() => {
          alert("‚úÖ Payment Approved! User now has access to " + itemKey);
        }).catch(err => {
          console.error(err);
          alert("‚ùå Failed to approve payment due to network error.");
        });
      }
    }

    function rejectPayment(reqId) {
      let reason = prompt("Enter rejection reason (e.g., Fake UTR, Unclear Image):");
      if (reason === null || reason.trim() === "") return; // cancelled

      // Update the request status to rejected
      database.ref('pendingPayments/' + reqId).update({
        status: "rejected",
        reason: reason.trim()
      }).then(() => {
        alert("‚ùå Request rejected and user notified.");
      }).catch(err => {
        alert("‚ùå Network Error.");
      });
    }

    function loadAdminData() {
      let tbody = document.getElementById("adminTableBody");
      tbody.innerHTML = ""; // clear old

      let hasData = false;
      let studentInfoList = [];
      for (let i = 0; i < localStorage.length; i++) {
        let key = localStorage.key(i);
        // Exclude system keys like courseData, session handles
        if (key === "courseData" || key === "activeSessionMobile" || key === "activeSessionExp") continue;

        try {
          let data = JSON.parse(localStorage.getItem(key));
          if (data && data.name && data.mobile && key === data.mobile) { // Verify it's a student record
            studentInfoList.push(data);
          }
        } catch (e) {
          // ignore non-json localstorage keys
        }
      }

      if (studentInfoList.length > 0) {
        hasData = true;
        studentInfoList.forEach(data => {
          let tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${data.name}</td>
            <td>${data.roll}</td>
            <td>${data.branch}</td>
            <td>${data.section}</td>
            <td>${data.mobile}</td>
          `;
          tbody.appendChild(tr);
        });
      }

      if (!hasData) {
        tbody.innerHTML = "<tr><td colspan='5' style='text-align:center;'>No registered students yet.</td></tr>";
      }

      initAdminCMS(); // Initialize the Content Management dropdowns

      let prPreview = document.getElementById("premiumQRPreview");
      let pConf = JSON.parse(localStorage.getItem("premiumConfig")) || { qr: "", upi: "", amount: "" };
      if (pConf.qr) {
        prPreview.src = pConf.qr;
        prPreview.style.display = "block";
      } else {
        prPreview.style.display = "none";
      }
      document.getElementById("premiumUPI").value = pConf.upi || "";
      document.getElementById("premiumAmount").value = pConf.amount || "";

      // Initialize Premium Config Dropdowns
      let pCmsCourse = document.getElementById("premConfigCourse");
      pCmsCourse.innerHTML = '<option value="" disabled selected>Select Premium Course</option>';
      for (let c in premiumData) {
        let opt = document.createElement("option"); opt.value = c; opt.innerText = c; pCmsCourse.appendChild(opt);
      }
      document.getElementById("premiumConfigEditor").style.display = "none";
    }

    function onAdminPremConfigCourseChange() {
      let course = document.getElementById("premConfigCourse").value;
      if (!course) return;

      let optSelect = document.getElementById("premConfigOption");
      optSelect.innerHTML = '<option value="" disabled selected>Select Option</option>';

      let options = premiumData[course] || {};
      for (let opt in options) {
        let op = document.createElement("option");
        op.value = opt;
        op.innerText = opt;
        optSelect.appendChild(op);
      }
      document.getElementById("premiumConfigEditor").style.display = "none";
    }

    function onAdminPremConfigOptionChange() {
      let course = document.getElementById("premConfigCourse").value;
      let option = document.getElementById("premConfigOption").value;
      if (!course || !option) return;

      let pConf = JSON.parse(localStorage.getItem("premiumCourseConfigs")) || {};
      let itemKey = course + "_" + option;
      let config = pConf[itemKey] || { qr: "", upi: "", amount: "" };

      let prPreview = document.getElementById("premiumQRPreview");
      if (config.qr) {
        prPreview.src = config.qr;
        prPreview.style.display = "block";
      } else {
        prPreview.style.display = "none";
      }
      document.getElementById("premiumUPI").value = config.upi || "";
      document.getElementById("premiumAmount").value = config.amount || "";

      document.getElementById("premiumConfigEditor").style.display = "block";
    }

    function initAdminCMS() {
      // Content Manager
      let cSelect = document.getElementById("cmsCourse");
      cSelect.innerHTML = '<option value="" disabled selected>Course</option>';
      for (let c in data) {
        let opt = document.createElement("option"); opt.value = c; opt.innerText = c; cSelect.appendChild(opt);
      }
      document.getElementById("cmsEditor").style.display = "none";

      // Subject Manager
      let subSelect = document.getElementById("subCourse");
      subSelect.innerHTML = '<option value="" disabled selected>Course</option>';
      for (let c in data) {
        let opt = document.createElement("option"); opt.value = c; opt.innerText = c; subSelect.appendChild(opt);
      }
      document.getElementById("subEditor").style.display = "none";
    }

    // CMS DYNAMIC FIELDS SCRIPTING
    function addCMSField(type, value = "") {
      let container = document.getElementById(`cms${type.charAt(0).toUpperCase() + type.slice(1)}Container`);
      let div = document.createElement("div");
      div.className = "cms-dynamic-field";

      let isTextArea = type === "notes" || type === "assignment" || type === "homework";
      let input = document.createElement(isTextArea ? "textarea" : "input");
      input.className = "login-input cms-input-val";
      input.style.marginTop = "0";
      input.style.marginBottom = "0";
      input.style.flex = "1";
      if (isTextArea) input.style.height = "60px";
      else input.type = "text";
      input.value = value;
      input.dataset.type = type;

      let delBtn = document.createElement("button");
      delBtn.className = "cms-del-btn";
      delBtn.innerText = "‚úñ";
      delBtn.onclick = function () { container.removeChild(div); };

      div.appendChild(input);
      div.appendChild(delBtn);
      container.appendChild(div);
    }

    function clearCMSFields() {
      ["Video", "Notes", "Pdf", "Assignment", "Homework"].forEach(t => {
        document.getElementById(`cms${t}Container`).innerHTML = "";
      });
    }

    function collectCMSFields(type) {
      let container = document.getElementById(`cms${type.charAt(0).toUpperCase() + type.slice(1)}Container`);
      let inputs = container.querySelectorAll(".cms-input-val");
      let values = [];
      inputs.forEach(ip => {
        if (ip.value.trim() !== "") values.push(ip.value.trim());
      });
      return values;
    }

    function exportToExcel() {
      let studentInfoList = [];
      for (let i = 0; i < localStorage.length; i++) {
        let key = localStorage.key(i);
        if (key === "courseData" || key === "activeSessionMobile" || key === "activeSessionExp") continue;
        try {
          let st = JSON.parse(localStorage.getItem(key));
          if (st && st.name && st.mobile && key === st.mobile) {
            studentInfoList.push(st);
          }
        } catch (e) { }
      }

      if (studentInfoList.length === 0) {
        alert("No student data available to export.");
        return;
      }

      let ws = XLSX.utils.json_to_sheet(studentInfoList);
      let wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Students");
      XLSX.writeFile(wb, "NextGenLibrary_Students.xlsx");
    }

    /* ADVANCED SITE SETTINGS */
    function loadSiteSettings() {
      let config = JSON.parse(localStorage.getItem("siteConfig")) || { ticker: "", welcome: "", about: "" };
      let tickerEl = document.getElementById("globalTicker");
      let tickerTextEl = document.getElementById("tickerText");

      if (config.ticker && config.ticker.trim() !== "") {
        tickerTextEl.innerText = config.ticker;
        tickerEl.style.display = "block";
        document.getElementById("siteTickerText").value = config.ticker;
      } else {
        tickerEl.style.display = "none";
        document.getElementById("siteTickerText").value = "";
      }

      let welcomeEl = document.getElementById("welcomeSubtitle");
      if (document.getElementById("siteWelcomeText")) {
        if (config.welcome && config.welcome.trim() !== "") {
          welcomeEl.innerText = config.welcome;
          document.getElementById("siteWelcomeText").value = config.welcome;
        } else {
          welcomeEl.innerText = "Your Digital Learning Hub"; // fallback
          document.getElementById("siteWelcomeText").value = "";
        }
      }

      let aboutEl = document.getElementById("aboutUsContent");
      if (document.getElementById("siteAboutText")) {
        if (config.about && config.about.trim() !== "") {
          // split by newlines and wrap in p tags for basic formatting
          let formattedAbout = config.about.split('\n').filter(p => p.trim() !== '').map(p => `<p>${p}</p>`).join('');
          aboutEl.innerHTML = formattedAbout;
          document.getElementById("siteAboutText").value = config.about;
        } else {
          // fallback to default
          aboutEl.innerHTML = `
            <p>Welcome to NextGen Library, your premier digital learning platform designed for modern students. We believe that quality education should be structured, accessible, and interactive.</p>
            <p>Our platform integrates:</p>
            <ul>
              <li>High-quality Video Lectures</li>
              <li>Meticulously curated Study Notes</li>
              <li>Rigorous Assignments & Practice</li>
              <li>Comprehensive Homework Guidance</li>
              <li>Instant Doubt Resolution Support</li>
            </ul>
            <p>Whether you're tackling daily challenges or seeking clarity, we provide the tools necessary for academic excellence and personal growth.</p>
          `;
          document.getElementById("siteAboutText").value = "";
        }
      }
    }

    function saveSiteSettings() {
      let ticker = document.getElementById("siteTickerText").value.trim();
      let welcome = document.getElementById("siteWelcomeText").value.trim();
      let about = document.getElementById("siteAboutText").value.trim();

      let payload = { ticker, welcome, about };

      database.ref('siteConfig').set(payload).then(() => {
        localStorage.setItem("siteConfig", JSON.stringify(payload));
        loadSiteSettings();
        alert("‚úÖ Site settings updated!");
      }).catch(err => {
        alert("‚ùå Failed to update site settings.");
      });
    }

    /* PREMIUM CONTENT CMS SETTINGS */
    let premiumData = JSON.parse(localStorage.getItem("premiumData")) || {
      "BCA": {
        "Nimcet & MCA": [],
        "Exam point of view": []
      },
      "BBA": {
        "MBA": [],
        "Exam point of view": []
      },
      "BTECH": {
        "MTech": [],
        "Semester point of view": []
      }
    };

    function savePremiumData() {
      database.ref('premiumData').set(premiumData).then(() => {
        // Sync to local memory
        localStorage.setItem("premiumData", JSON.stringify(premiumData));
      }).catch(err => {
        console.error("Premium data save failed", err);
      });
    }

    function onPremCourseChange() {
      let course = document.getElementById("premCmsCourse").value;
      if (!course) return;
      document.getElementById("premEditor").style.display = "block";

      let optSelect = document.getElementById("premCmsOption");
      optSelect.innerHTML = '<option value="" disabled selected>Select Option</option>';

      let options = premiumData[course] || {};
      for (let opt in options) {
        let op = document.createElement("option");
        op.value = opt;
        op.innerText = opt;
        optSelect.appendChild(op);
      }

      document.getElementById("adminPremPdfList").innerHTML = "";
    }

    function onPremOptionChange() {
      renderPremPdfList();
    }

    function addPremiumOption() {
      let course = document.getElementById("premCmsCourse").value;
      let newOptName = document.getElementById("newPremOptionName").value.trim();
      if (!course || !newOptName) {
        alert("Please select a course and type an option name.");
        return;
      }

      if (!premiumData[course]) premiumData[course] = {};
      if (premiumData[course][newOptName]) {
        alert("Option already exists!");
        return;
      }

      premiumData[course][newOptName] = [];
      savePremiumData();

      document.getElementById("newPremOptionName").value = "";
      onPremCourseChange(); // Reload dropdown
      document.getElementById("premCmsOption").value = newOptName;
      onPremOptionChange();
    }

    function addPremiumPdf() {
      let course = document.getElementById("premCmsCourse").value;
      let option = document.getElementById("premCmsOption").value;
      let title = document.getElementById("newPremPdfTitle").value.trim();
      let link = document.getElementById("newPremPdfLink").value.trim();

      if (!course || !option || !title || !link) {
        alert("Please fill out all fields.");
        return;
      }

      premiumData[course][option].push({ title, link });
      savePremiumData();

      document.getElementById("newPremPdfTitle").value = "";
      document.getElementById("newPremPdfLink").value = "";
      renderPremPdfList();
    }

    function removePremiumPdf(index) {
      if (!confirm("Are you sure you want to delete this PDF?")) return;
      let course = document.getElementById("premCmsCourse").value;
      let option = document.getElementById("premCmsOption").value;

      premiumData[course][option].splice(index, 1);
      savePremiumData();
      renderPremPdfList();
    }

    function renderPremPdfList() {
      let course = document.getElementById("premCmsCourse").value;
      let option = document.getElementById("premCmsOption").value;
      let list = document.getElementById("adminPremPdfList");
      list.innerHTML = "";

      if (!course || !option) return;

      let pdfs = premiumData[course][option];
      if (!pdfs || pdfs.length === 0) {
        list.innerHTML = "<li style='color:#ccc;'>No PDFs added yet.</li>";
        return;
      }

      pdfs.forEach((pdf, index) => {
        let li = document.createElement("li");
        li.style.cssText = "display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(0,255,255,0.05); margin-bottom: 5px; border-radius: 5px;";
        li.innerHTML = `
          <span><b>${pdf.title}</b> <small style="color:#aaa;">(${pdf.link})</small></span>
          <button onclick="removePremiumPdf(${index})" style="background: transparent; color: #ff4757; border: 1px solid #ff4757; padding: 3px 8px; border-radius: 3px; cursor: pointer;">Delete</button>
        `;
        list.appendChild(li);
      });
    }

    function onAdminCourseChange() {
      let c = document.getElementById("cmsCourse").value;
      let bSelect = document.getElementById("cmsBranch");
      bSelect.innerHTML = '<option value="" disabled selected>Branch</option>';
      if (data[c]) {
        for (let b in data[c]) {
          let opt = document.createElement("option"); opt.value = b; opt.innerText = b; bSelect.appendChild(opt);
        }
      }
      document.getElementById("cmsSemester").innerHTML = '<option value="" disabled selected>Semester</option>';
      document.getElementById("cmsSubject").innerHTML = '<option value="" disabled selected>Subject</option>';
      document.getElementById("cmsChapter").innerHTML = '<option value="" disabled selected>Chapter</option>';
      document.getElementById("cmsEditor").style.display = "none";
    }

    function onAdminBranchChange() {
      let c = document.getElementById("cmsCourse").value;
      let b = document.getElementById("cmsBranch").value;
      let sSelect = document.getElementById("cmsSemester");
      sSelect.innerHTML = '<option value="" disabled selected>Semester</option>';
      if (data[c] && data[c][b]) {
        for (let s in data[c][b]) {
          let opt = document.createElement("option"); opt.value = s; opt.innerText = "Semester " + s; sSelect.appendChild(opt);
        }
      }
      document.getElementById("cmsSubject").innerHTML = '<option value="" disabled selected>Subject</option>';
      document.getElementById("cmsChapter").innerHTML = '<option value="" disabled selected>Chapter</option>';
      document.getElementById("cmsEditor").style.display = "none";
    }

    function onAdminSemesterChange() {
      let c = document.getElementById("cmsCourse").value;
      let b = document.getElementById("cmsBranch").value;
      let sem = document.getElementById("cmsSemester").value;
      let subjSelect = document.getElementById("cmsSubject");
      subjSelect.innerHTML = '<option value="" disabled selected>Subject</option>';
      if (data[c] && data[c][b] && data[c][b][sem]) {
        for (let sub in data[c][b][sem]) {
          let opt = document.createElement("option"); opt.value = sub; opt.innerText = sub; subjSelect.appendChild(opt);
        }
      }
      document.getElementById("cmsChapter").innerHTML = '<option value="" disabled selected>Chapter</option>';
      document.getElementById("cmsEditor").style.display = "none";
    }

    function onAdminSubjectChange() {
      let c = document.getElementById("cmsCourse").value;
      let b = document.getElementById("cmsBranch").value;
      let sem = document.getElementById("cmsSemester").value;
      let sub = document.getElementById("cmsSubject").value;
      let chapSelect = document.getElementById("cmsChapter");
      chapSelect.innerHTML = '<option value="" disabled selected>Chapter</option>';
      if (data[c] && data[c][b] && data[c][b][sem] && data[c][b][sem][sub]) {
        for (let chap in data[c][b][sem][sub]) {
          let opt = document.createElement("option"); opt.value = chap; opt.innerText = chap; chapSelect.appendChild(opt);
        }
      }
      document.getElementById("cmsEditor").style.display = "none";
    }

    function onAdminChapterChange() {
      let c = document.getElementById("cmsCourse").value;
      let b = document.getElementById("cmsBranch").value;
      let sem = document.getElementById("cmsSemester").value;
      let sub = document.getElementById("cmsSubject").value;
      let chap = document.getElementById("cmsChapter").value;

      clearCMSFields();

      if (c && b && sem && sub && chap && data[c] && data[c][b] && data[c][b][sem] && data[c][b][sem][sub] && data[c][b][sem][sub][chap]) {
        let content = data[c][b][sem][sub][chap];

        // Handle migration from old string format -> array format seamlessly
        const populateFields = (type, val) => {
          if (!val) return;
          if (Array.isArray(val)) {
            val.forEach(v => addCMSField(type, v));
          } else if (typeof val === "string") {
            // Old format: split by newline if applicable, otherwise just 1
            let arr = val.split('\n');
            arr.forEach(v => { if (v.trim()) addCMSField(type, v.trim()); });
          }
        };

        populateFields('video', content.video);
        populateFields('notes', content.notes);
        populateFields('pdf', content.pdf);
        populateFields('assignment', content.assignment);
        populateFields('homework', content.homework);

        // Auto-add 1 empty field if entirely empty
        ["video", "notes", "pdf", "assignment", "homework"].forEach(type => {
          let container = document.getElementById(`cms${type.charAt(0).toUpperCase() + type.slice(1)}Container`);
          if (container.children.length === 0) addCMSField(type, "");
        });

        document.getElementById("cmsEditor").style.display = "block";
      }
    }

    function saveAdminContent() {
      let c = document.getElementById("cmsCourse").value;
      let b = document.getElementById("cmsBranch").value;
      let sem = document.getElementById("cmsSemester").value;
      let sub = document.getElementById("cmsSubject").value;
      let chap = document.getElementById("cmsChapter").value;

      if (!c || !b || !sem || !sub || !chap) return;

      let payload = {
        video: collectCMSFields('video'),
        notes: collectCMSFields('notes'),
        pdf: collectCMSFields('pdf'),
        assignment: collectCMSFields('assignment'),
        homework: collectCMSFields('homework')
      };

      data[c][b][sem][sub][chap] = payload;

      database.ref(`courseData/${c}/${b}/${sem}/${sub}/${chap}`).set(payload).then(() => {
        localStorage.setItem("courseData", JSON.stringify(data));
        alert("‚úÖ Content for '" + chap + "' has been updated successfully!");
      }).catch(err => {
        alert("‚ùå Failed to save content to database.");
      });
    }

    // COURSE & SUBJECT MANAGER FUNCTIONS
    function addAdminCourse() {
      let newCourse = document.getElementById("newCourseName").value.trim().toUpperCase();
      if (!newCourse) return alert("Course name cannot be empty.");
      if (data[newCourse]) return alert(`Course '${newCourse}' already exists!`);

      // Initialize completely new course with generic branches & semesters
      data[newCourse] = {
        "General": {
          1: {}, 2: {}, 3: {}, 4: {}, 5: {}, 6: {}
        }
      };

      database.ref(`courseData/${newCourse}`).set(data[newCourse]).then(() => {
        localStorage.setItem("courseData", JSON.stringify(data));
        document.getElementById("newCourseName").value = "";
        alert(`‚úÖ Course '${newCourse}' added successfully! Branches 'General' and Semesters 1-6 created by default.`);
        initAdminCMS(); // Reload dropdowns
      });
    }

    function onSubCourseChange() {
      let c = document.getElementById("subCourse").value;
      let bSelect = document.getElementById("subBranch");
      bSelect.innerHTML = '<option value="" disabled selected>Branch</option>';
      if (data[c]) {
        for (let b in data[c]) {
          let opt = document.createElement("option"); opt.value = b; opt.innerText = b; bSelect.appendChild(opt);
        }
      }
      document.getElementById("subSemester").innerHTML = '<option value="" disabled selected>Semester</option>';
      document.getElementById("subEditor").style.display = "none";
    }

    function onSubBranchChange() {
      let c = document.getElementById("subCourse").value;
      let b = document.getElementById("subBranch").value;
      let sSelect = document.getElementById("subSemester");
      sSelect.innerHTML = '<option value="" disabled selected>Semester</option>';
      if (data[c] && data[c][b]) {
        for (let s in data[c][b]) {
          let opt = document.createElement("option"); opt.value = s; opt.innerText = "Semester " + s; sSelect.appendChild(opt);
        }
      }
      document.getElementById("subEditor").style.display = "none";
    }

    function onSubSemesterChange() {
      renderAdminSubjectList();
    }

    function renderAdminSubjectList() {
      let c = document.getElementById("subCourse").value;
      let b = document.getElementById("subBranch").value;
      let sem = document.getElementById("subSemester").value;
      let list = document.getElementById("adminSubjectList");
      list.innerHTML = "";

      if (c && b && sem && data[c] && data[c][b] && data[c][b][sem]) {
        let subjects = Object.keys(data[c][b][sem]);
        if (subjects.length === 0) {
          list.innerHTML = "<li style='color:#888;'>No subjects found in this semester.</li>";
        } else {
          subjects.forEach(sub => {
            let li = document.createElement("li");
            li.innerHTML = `
              <span>üìò ${sub}</span>
              <button class="delete-subject-btn" onclick="deleteAdminSubject('${c}', '${b}', '${sem}', '${sub}')">üóëÔ∏è Delete</button>
            `;
            list.appendChild(li);
          });
        }
        document.getElementById("subEditor").style.display = "block";
      }
    }

    function addAdminSubject() {
      let c = document.getElementById("subCourse").value;
      let b = document.getElementById("subBranch").value;
      let sem = document.getElementById("subSemester").value;
      let subName = document.getElementById("newSubjectName").value.trim();

      if (!c || !b || !sem) return alert("Please select Course, Branch, and Semester first.");
      if (!subName) return alert("Subject name cannot be empty.");

      if (data[c][b][sem][subName]) {
        return alert("Subject already exists in this semester!");
      }

      // Initialize with basic Units 1 to 5 mapping
      let initPayload = {
        "UNIT 1: Introduction": { video: "", notes: "", pdf: "", assignment: "", homework: "" },
        "UNIT 2: Basics": { video: "", notes: "", pdf: "", assignment: "", homework: "" },
        "UNIT 3: Intermediate": { video: "", notes: "", pdf: "", assignment: "", homework: "" },
        "UNIT 4: Advanced": { video: "", notes: "", pdf: "", assignment: "", homework: "" },
        "UNIT 5: Expert": { video: "", notes: "", pdf: "", assignment: "", homework: "" }
      };

      data[c][b][sem][subName] = initPayload;

      database.ref(`courseData/${c}/${b}/${sem}/${subName}`).set(initPayload).then(() => {
        localStorage.setItem("courseData", JSON.stringify(data));
        document.getElementById("newSubjectName").value = "";
        alert("‚úÖ Subject '" + subName + "' added successfully!");
        renderAdminSubjectList();
        onAdminSemesterChange(); // Update CMS dropdown if affected
      });
    }

    function deleteAdminSubject(c, b, sem, sub) {
      if (confirm(`Are you sure you want to delete the subject '${sub}'? This will remove all its content permanently.`)) {
        delete data[c][b][sem][sub];
        database.ref(`courseData/${c}/${b}/${sem}/${sub}`).remove().then(() => {
          localStorage.setItem("courseData", JSON.stringify(data));
          renderAdminSubjectList();
          onAdminSemesterChange(); // Update CMS dropdown
        });
      }
    }

    // FORGOT DETAILS RECOVERY & EDIT PROFILE VARS
    // isRecoveringMode is declared above

    function recoverDetails() {
      let rollSearch = prompt("Enter your registered DDU Roll Number to recover/edit your details:");
      if (!rollSearch || rollSearch.trim() === "") return;

      let foundUser = null;
      for (let i = 0; i < localStorage.length; i++) {
        let key = localStorage.key(i);
        try {
          let data = JSON.parse(localStorage.getItem(key));
          if (data && data.roll && data.roll.toLowerCase() === rollSearch.trim().toLowerCase()) {
            foundUser = data;
            break;
          }
        } catch (e) { }
      }

      if (foundUser) {
        // Open Edit Profile screen in recovery mode
        isRecoveringMode = true;
        tempRecoverMobile = foundUser.mobile;

        document.getElementById("editName").value = foundUser.name;
        document.getElementById("editRoll").value = foundUser.roll;
        document.getElementById("editBranch").value = foundUser.branch;
        document.getElementById("editSection").value = foundUser.section;
        document.getElementById("editMobile").value = foundUser.mobile;

        document.querySelector("#editProfileScreen h2").innerText = "üõ†Ô∏è Fix Registration Details";
        document.getElementById("editProfileScreen").style.display = "flex";
      } else {
        alert("Sorry, no account found matching this DDU Roll Number. You may need to Sign Up first.");
      }
    }

    // VALIDATION HELPERS
    function validateInput(name, roll, mobile) {
      if (!/^[A-Za-z\s]+$/.test(name)) {
        alert("Validation Error: Name must contain only English alphabets and spaces.");
        return false;
      }
      if (!/^\d{13}$/.test(roll)) {
        alert("Validation Error: DDU Roll Number must be exactly 13 digits long.");
        return false;
      }
      if (!/^\d{10}$/.test(mobile)) {
        alert("Validation Error: Mobile Number must be exactly 10 digits long.");
        return false;
      }
      return true;
    }

    function handleSignUp() {
      let name = document.getElementById("regName").value.trim();
      let roll = document.getElementById("regRoll").value.trim();
      let branch = document.getElementById("regBranch").value;
      let section = document.getElementById("regSection").value;
      let mobile = document.getElementById("regMobile").value.trim();

      if (!name || !roll || !branch || !section || !mobile) {
        alert("Please fill in all details to register!");
        return;
      }

      if (!validateInput(name, roll, mobile)) return;

      // Disable button to prevent double clicks
      let btn = document.querySelector("#signUpForm .login-btn");
      btn.innerText = "Registering...";
      btn.disabled = true;

      // Check if user already exists
      database.ref('users/' + mobile).once('value').then((snapshot) => {
        if (snapshot.exists()) {
          alert("An account with this mobile number already exists! Please login.");
          toggleAuthMode('login');
          btn.innerText = "Sign Up & Enter";
          btn.disabled = false;
          return;
        }

        let userData = {
          name,
          roll,
          branch,
          section,
          mobile,
          registeredAt: Date.now()
        };

        database.ref('users/' + mobile).set(userData).then(() => {
          // Sync to local for offline backwards compatibility for progress trackers
          localStorage.setItem(mobile, JSON.stringify(userData));

          // Save Persistent Session (5 hours = 5 * 60 * 60 * 1000 ms)
          localStorage.setItem("activeSessionMobile", mobile);
          localStorage.setItem("activeSessionExp", (Date.now() + 5 * 60 * 60 * 1000).toString());

          currentUserMobile = mobile;

          alert("Registration Successful! Welcome to NextGen Library.");
          document.getElementById("loginScreen").style.display = "none";
          document.getElementById("welcomeScreen").style.display = "flex";

          // Update welcome text with Name
          let wsP = document.querySelector("#welcomeScreen p");
          wsP.innerText = wsP.innerText.split('\n')[0] + `\nWelcome, ${name}!`;

          btn.innerText = "Sign Up & Enter";
          btn.disabled = false;
        }).catch(err => {
          console.error(err);
          alert("Network error, please try again.");
          btn.innerText = "Sign Up & Enter";
          btn.disabled = false;
        });
      });
    }

    function handleLogin() {
      let name = document.getElementById("loginName").value.trim();
      let mobile = document.getElementById("loginMobile").value.trim();
      let section = document.getElementById("loginSection").value;

      if (!name || !mobile || !section) {
        alert("Please enter Name, Section, and Mobile Number!");
        return;
      }

      let btn = document.querySelector("#loginForm .login-btn");
      btn.innerText = "Logging in...";
      btn.disabled = true;

      database.ref('users/' + mobile).once('value').then((snapshot) => {
        let savedData = snapshot.val();

        if (savedData) {
          if (savedData.name.toLowerCase() === name.toLowerCase() && savedData.section === section) {

            // Backwards compatibility sync
            let stObj = JSON.parse(localStorage.getItem(mobile)) || {};
            let merged = { ...savedData, progressTracker: stObj.progressTracker || {} };
            localStorage.setItem(mobile, JSON.stringify(merged));

            // Save Persistent Session
            localStorage.setItem("activeSessionMobile", mobile);
            localStorage.setItem("activeSessionExp", (Date.now() + 5 * 60 * 60 * 1000).toString());

            currentUserMobile = mobile;
            document.getElementById("loginScreen").style.display = "none";
            document.getElementById("welcomeScreen").style.display = "flex";
            let wsP = document.querySelector("#welcomeScreen p");
            wsP.innerText = wsP.innerText.split('\n')[0] + `\nWelcome back, ${savedData.name}!`;

          } else {
            alert("Incorrect Name or Section for this Mobile Number.");
          }
        } else {
          alert("Mobile number not found! Please sign up first.");
          toggleAuthMode('signup');
        }
        btn.innerText = "Log In";
        btn.disabled = false;
      }).catch(err => {
        alert("Network Error, please try again.");
        btn.innerText = "Log In";
        btn.disabled = false;
      });
    }

    // EDIT PROFILE FUNCTIONS
    function openEditProfile() {
      if (!currentUserMobile) {
        alert("You must be logged in to edit your profile.");
        return;
      }
      isRecoveringMode = false;
      document.querySelector("#editProfileScreen h2").innerText = "‚úèÔ∏è Edit Profile";

      let savedData = localStorage.getItem(currentUserMobile);
      if (savedData) {
        let user = JSON.parse(savedData);
        document.getElementById("editName").value = user.name;
        document.getElementById("editRoll").value = user.roll;
        document.getElementById("editBranch").value = user.branch;
        document.getElementById("editSection").value = user.section;
        document.getElementById("editMobile").value = user.mobile;

        document.getElementById("editProfileScreen").style.display = "flex";
      }
    }

    function closeEditProfile() {
      document.getElementById("editProfileScreen").style.display = "none";
      isRecoveringMode = false;
    }

    function saveProfileChanges() {
      let newName = document.getElementById("editName").value.trim();
      let newRoll = document.getElementById("editRoll").value.trim();
      let newBranch = document.getElementById("editBranch").value;
      let newSection = document.getElementById("editSection").value;
      let newMobile = document.getElementById("editMobile").value.trim();

      if (!newName || !newRoll || !newBranch || !newSection || !newMobile) {
        alert("Please fill in all details to update your profile!");
        return;
      }

      if (!validateInput(newName, newRoll, newMobile)) return;

      let activeMobileKey = isRecoveringMode ? tempRecoverMobile : currentUserMobile;

      // Check if mobile changed and new mobile already exists
      if (newMobile !== activeMobileKey) {
        database.ref('users/' + newMobile).once('value').then(snap => {
          if (snap.exists()) {
            alert("The new mobile number is already registered by another user.");
            return;
          } else {
            executeProfileUpdate(activeMobileKey, newName, newRoll, newBranch, newSection, newMobile);
          }
        });
      } else {
        executeProfileUpdate(activeMobileKey, newName, newRoll, newBranch, newSection, newMobile);
      }
    }

    function executeProfileUpdate(activeMobileKey, newName, newRoll, newBranch, newSection, newMobile) {
      let updatedData = {
        name: newName,
        roll: newRoll,
        branch: newBranch,
        section: newSection,
        mobile: newMobile
      };

      // Keep offline compat tracker
      let stObj = JSON.parse(localStorage.getItem(activeMobileKey)) || {};

      database.ref('users/' + newMobile).update(updatedData).then(() => {
        if (newMobile !== activeMobileKey) {
          database.ref('users/' + activeMobileKey).remove(); // clear old node
          localStorage.removeItem(activeMobileKey);
        }

        let merged = { ...updatedData, progressTracker: stObj.progressTracker || {}, premiumUnlocked: stObj.premiumUnlocked || {} };
        localStorage.setItem(newMobile, JSON.stringify(merged));

        if (!isRecoveringMode) {
          currentUserMobile = newMobile; // update tracking
          localStorage.setItem("activeSessionMobile", newMobile);
          let wsP = document.querySelector("#welcomeScreen p");
          wsP.innerText = wsP.innerText.split('\n')[0] + `\nWelcome, ${newName}!`;
        }

        alert(isRecoveringMode ? "Registration Fixed Successfully! Please log in." : "Profile updated successfully!");
        closeEditProfile();

        if (isRecoveringMode) {
          toggleAuthMode('login');
        }
      });
    }

    // -------------- PROGRESS TRACKING LOGIC --------------
    function getStudentTracker() {
      let stObj = JSON.parse(localStorage.getItem(currentUserMobile));
      if (!stObj.progressTracker) {
        stObj.progressTracker = {}; // Backwards compat fix
        localStorage.setItem(currentUserMobile, JSON.stringify(stObj));
      }
      return stObj;
    }

    function toggleProgress(type, index, isChecked) {
      let stObj = getStudentTracker();
      let c = studentNavState.course;
      let b = studentNavState.branch;
      let sem = studentNavState.sem;
      let sub = studentNavState.subject;
      let ch = studentNavState.chapter;

      if (!stObj.progressTracker[c]) stObj.progressTracker[c] = {};
      if (!stObj.progressTracker[c][b]) stObj.progressTracker[c][b] = {};
      if (!stObj.progressTracker[c][b][sem]) stObj.progressTracker[c][b][sem] = {};
      if (!stObj.progressTracker[c][b][sem][sub]) stObj.progressTracker[c][b][sem][sub] = {};
      if (!stObj.progressTracker[c][b][sem][sub][ch]) stObj.progressTracker[c][b][sem][sub][ch] = {};
      if (!stObj.progressTracker[c][b][sem][sub][ch][type]) stObj.progressTracker[c][b][sem][sub][ch][type] = {};

      stObj.progressTracker[c][b][sem][sub][ch][type][index] = isChecked;
      localStorage.setItem(currentUserMobile, JSON.stringify(stObj));
    }

    function isProgressCompleted(type, index) {
      let stObj = getStudentTracker();
      let c = studentNavState.course;
      let b = studentNavState.branch;
      let sem = studentNavState.sem;
      let sub = studentNavState.subject;
      let ch = studentNavState.chapter;

      try {
        return !!stObj.progressTracker[c][b][sem][sub][ch][type][index];
      } catch (e) {
        return false;
      }
    }

    function renderProgressDashboard() {
      let dashView = document.getElementById("progressContent");
      if (!dashView) return;
      dashView.innerHTML = "";

      let c = studentNavState.course;
      let b = studentNavState.branch;
      let sem = studentNavState.sem;

      if (!data[c] || !data[c][b] || !data[c][b][sem]) {
        dashView.innerHTML = "<p>No data to analyze for this semester.</p>";
        return;
      }

      let semesterData = data[c][b][sem];
      let stObj = getStudentTracker();
      let overallContentSum = 0;
      let overallCompletedSum = 0;

      let htmlOutput = "";

      for (let subName in semesterData) {
        let totalItems = 0;
        let completedItems = 0;
        let breakdown = { video: { t: 0, c: 0 }, pdf: { t: 0, c: 0 }, assign: { t: 0, c: 0 }, hw: { t: 0, c: 0 } };

        let subChapters = semesterData[subName];
        for (let chName in subChapters) {
          let content = subChapters[chName];

          const processType = (type, alias) => {
            let arr = [];
            if (Array.isArray(content[type])) arr = content[type];
            else if (typeof content[type] === "string" && content[type].trim()) arr = content[type].split('\n').filter(x => x.trim());

            totalItems += arr.length;
            breakdown[alias].t += arr.length;
            overallContentSum += arr.length;

            if (arr.length > 0) {
              for (let i = 0; i < arr.length; i++) {
                try {
                  if (stObj.progressTracker[c][b][sem][subName][chName][type][i]) {
                    completedItems++;
                    breakdown[alias].c++;
                    overallCompletedSum++;
                  }
                } catch (e) { }
              }
            }
          };

          processType('video', 'video');
          processType('pdf', 'pdf');
          processType('assignment', 'assign');
          processType('homework', 'hw');
        }

        if (totalItems > 0) {
          let percentage = Math.round((completedItems / totalItems) * 100);

          htmlOutput += `
            <div class="subj-progress">
              <div class="subj-progress-title">
                <span>${subName}</span>
                <span>${percentage}%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width: ${percentage}%"></div>
              </div>
              <div class="progress-details">
                ${breakdown.video.t > 0 ? `<span>üìπ Videos: ${breakdown.video.c}/${breakdown.video.t}</span>` : ""}
                ${breakdown.pdf.t > 0 ? `<span>üìÑ PDFs: ${breakdown.pdf.c}/${breakdown.pdf.t}</span>` : ""}
                ${breakdown.assign.t > 0 ? `<span>‚úèÔ∏è Assignments: ${breakdown.assign.c}/${breakdown.assign.t}</span>` : ""}
                ${breakdown.hw.t > 0 ? `<span>üè† HW: ${breakdown.hw.c}/${breakdown.hw.t}</span>` : ""}
              </div>
            </div>
          `;
        }
      }

      if (htmlOutput) {
        let grandTotal = overallContentSum > 0 ? Math.round((overallCompletedSum / overallContentSum) * 100) : 0;
        dashView.innerHTML = `
          <h4 style="color: white; margin-bottom: 20px;">Semester Completion: ${grandTotal}% (${overallCompletedSum}/${overallContentSum} items)</h4>
          ${htmlOutput}
        `;
      } else {
        dashView.innerHTML = "<p>Ask your Admin to upload Videos/PDFs to start tracking your progress!</p>";
      }
    }

    function enterSite() {
      document.getElementById("welcomeScreen").style.display = "none";
      document.querySelector("header").style.display = "flex";
      document.getElementById("programsWrapper").style.display = "block";
    }

    function goBackToPrograms() {
      document.getElementById("programsWrapper").style.display = "block";
    }

    let studentNavState = { course: "", branch: "", sem: "", subject: "" };
    let currentNavLevel = "programs"; // programs -> branches -> semesters -> subjects -> chapters

    function openStudentLevel(level, selection) {
      document.getElementById("programsWrapper").style.display = "none";
      document.getElementById("semesterMotivationSection").style.display = "none";
      document.getElementById("dynamicNavSection").style.display = "block";

      let container = document.getElementById("dynamicNavContainer");
      let html = "";

      if (level === 'course') {
        studentNavState.course = selection;
        currentNavLevel = 'branches';
        let branches = data[selection];
        for (let br in branches) {
          html += `<div class="box" onclick="openStudentLevel('branch', '${br}')">üè¢ ${br}</div>`;
        }
      }
      else if (level === 'branch') {
        studentNavState.branch = selection;
        currentNavLevel = 'semesters';
        let sems = data[studentNavState.course][selection];
        for (let s in sems) {
          html += `<div class="box" onclick="openStudentLevel('semester', '${s}')">üìö Semester ${s}</div>`;
        }
        document.getElementById("semesterMotivationSection").style.display = "block";
        renderProgressDashboard();
      }
      else if (level === 'semester') {
        studentNavState.sem = selection;
        currentNavLevel = 'subjects';
        let subs = data[studentNavState.course][studentNavState.branch][selection];
        for (let sub in subs) {
          html += `<div class="box" onclick="openStudentLevel('subject', '${sub}')">üìò ${sub}</div>`;
        }
      }
      else if (level === 'subject') {
        studentNavState.subject = selection;
        currentNavLevel = 'chapters';
        // Hide dynamicNavSection, show original #chapters UI
        document.getElementById("dynamicNavSection").style.display = "none";
        document.getElementById("chapters").style.display = "block";
        document.getElementById("subjectTitle").innerText = selection + " Chapters";

        let chapters = data[studentNavState.course][studentNavState.branch][studentNavState.sem][selection];
        let chList = "";
        for (let ch in chapters) {
          chList += `<li onclick="openStudentChapter('${ch}')">${ch}</li>`;
        }
        document.getElementById("chapterList").innerHTML = chList;
        return;
      }

      container.innerHTML = html;
    }

    function goBackDynamicNav() {
      if (currentNavLevel === 'branches') {
        document.getElementById("dynamicNavSection").style.display = "none";
        document.getElementById("programsWrapper").style.display = "block";
        currentNavLevel = 'programs';
      } else if (currentNavLevel === 'semesters') {
        openStudentLevel('course', studentNavState.course);
      } else if (currentNavLevel === 'subjects') {
        openStudentLevel('branch', studentNavState.branch);
        renderProgressDashboard();
      }
    }

    function goBackToSubjects() {
      document.getElementById("chapters").style.display = "none";
      openStudentLevel('semester', studentNavState.sem);
    }

    function openStudentChapter(ch) {
      studentNavState.chapter = ch;
      document.getElementById("chapters").style.display = "none";
      document.getElementById("content").style.display = "block";

      document.getElementById("chapterTitle").innerText = ch;

      let c = studentNavState.course;
      let b = studentNavState.branch;
      let sem = studentNavState.sem;
      let sub = studentNavState.subject;
      let chapterData = data[c][b][sem][sub][ch];

      // Helper to uniformly process arrays or fallback legacy strings
      const getArray = (val) => {
        if (!val) return [];
        if (Array.isArray(val)) return val;
        if (typeof val === "string") return val.split('\n').filter(v => v.trim() !== "");
        return [];
      };

      // Format Multi-line Text blocks with Line Breaks cleanly
      const formatTextBlocks = (arr) => arr.map(t => t ? t.replace(/\n/g, '<br>') : "").join('<br><br>');

      // Render Multiple Videos
      let vContainer = document.getElementById("videoContainer");
      vContainer.innerHTML = "";
      let videoArr = getArray(chapterData.video);

      if (videoArr.length > 0) {
        videoArr.forEach((v, idx) => {
          let wrapper = document.createElement("div");
          let iframe = document.createElement("iframe");
          iframe.width = "560";
          iframe.height = "315";
          iframe.frameBorder = "0";
          iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
          iframe.allowFullscreen = true;
          iframe.style.maxWidth = "100%";
          iframe.src = v;
          wrapper.appendChild(iframe);

          // Auto-mark as completed when rendered
          let isDone = isProgressCompleted("video", idx);
          if (!isDone) {
            toggleProgress('video', idx, true);
          }

          vContainer.appendChild(wrapper);
        });
        document.getElementById("videoSection").style.display = "block";
      } else {
        document.getElementById("videoSection").style.display = "none";
      }

      // Render Content Blocks
      const renderBlock = (arr, elementId, secId, type) => {
        let wrapper = document.getElementById(elementId);
        wrapper.innerHTML = "";

        if (arr.length > 0) {
          arr.forEach((text, idx) => {
            let pDiv = document.createElement("div");
            pDiv.innerHTML = formatTextBlocks([text]);

            // Auto-mark as completed when rendered
            let isDone = isProgressCompleted(type, idx);
            if (!isDone) {
              toggleProgress(type, idx, true);
            }

            pDiv.appendChild(document.createElement("hr"));
            wrapper.appendChild(pDiv);
          });
          document.getElementById(secId).style.display = "block";
        } else {
          document.getElementById(secId).style.display = "none";
        }
      };

      renderBlock(getArray(chapterData.assignment), "assignmentText", "assignmentSection", "assignment");
      renderBlock(getArray(chapterData.homework), "homeworkText", "homeworkSection", "homework");

      let notesArr = getArray(chapterData.notes);
      document.getElementById("notesText").innerHTML = formatTextBlocks(notesArr);

      // Render Multiple PDFs
      let pContainer = document.getElementById("pdfContainer");
      pContainer.innerHTML = "";
      let pdfArr = getArray(chapterData.pdf);

      if (pdfArr.length > 0) {
        pdfArr.forEach((pUrl, idx) => {
          let fileId = pUrl.match(/\/d\/(.*?)\//)?.[1];
          if (fileId) {
            let wrapper = document.createElement("div");
            wrapper.style.position = "relative"; // Key for absolute overlay

            let iframe = document.createElement("iframe");
            iframe.width = "100%";
            iframe.height = "500";
            iframe.frameBorder = "0";
            iframe.style.borderRadius = "8px";
            // Prevent pop-ups to block opening in a new tab for download
            iframe.setAttribute("sandbox", "allow-scripts allow-same-origin");
            iframe.src = "https://drive.google.com/file/d/" + fileId + "/preview?rm=minimal#toolbar=0";
            wrapper.appendChild(iframe);

            // Block clicks on the top-right toolbar (Google Drive action buttons)
            let securityOverlay = document.createElement("div");
            securityOverlay.style.position = "absolute";
            securityOverlay.style.top = "0";
            securityOverlay.style.left = "0";
            securityOverlay.style.width = "100%";
            securityOverlay.style.height = "60px"; // Size of the top header toolbar
            securityOverlay.style.background = "transparent";
            securityOverlay.style.zIndex = "10";
            securityOverlay.oncontextmenu = () => false; // Prevent right-click options in this zone
            wrapper.appendChild(securityOverlay);

            wrapper.style.marginBottom = "15px";

            // Auto-mark as completed when rendered
            let isDone = isProgressCompleted("pdf", idx);
            if (!isDone) {
              toggleProgress('pdf', idx, true);
            }

            pContainer.appendChild(wrapper);
          }
        });
        document.getElementById("pdfSection").style.display = pContainer.children.length > 0 ? "block" : "none";
      } else {
        document.getElementById("pdfSection").style.display = "none";
      }
    }

    function goBack() {
      document.getElementById("chapters").style.display = "none";
      document.getElementById("subjects").style.display = "grid";
    }

    function goBackChapter() {
      document.getElementById("content").style.display = "none";
      document.getElementById("chapters").style.display = "block";
    }

    function toggleTask(checkbox) {
      let taskItem = checkbox.parentElement;
      if (checkbox.checked) {
        taskItem.classList.add("completed");
      } else {
        taskItem.classList.remove("completed");
      }
    }

    function toggleMode() {
      document.body.classList.toggle("light");
      let btn = document.getElementById("themeToggleBtn");
      if (document.body.classList.contains("light")) {
        btn.innerText = "üåô";
      } else {
        btn.innerText = "üåû";
      }
    }

    function searchChapter(val) {
      let items = document.querySelectorAll("li");
      items.forEach(i => {
        i.style.display = i.innerText.toLowerCase().includes(val.toLowerCase()) ? "block" : "none";
      });
    }

    // --- GEMINI AI TUTOR LOGIC ---
    // PASTE YOUR NEW GEMINI API KEY HERE (Line 3376)
    const NEXTGEN_AI = "AIzaSyD5h0roGpYOMskKeB2lCLDqjGyase42DZ0";

    function toggleChat() {
      let chatBox = document.getElementById("aiChatBox");
      if (chatBox.style.display === "none" || chatBox.style.display === "") {
        chatBox.style.display = "flex";
      } else {
        chatBox.style.display = "none";
      }
    }

    async function sendChatMessage() {
      let inputField = document.getElementById("aiChatInput");
      let message = inputField.value.trim();
      if (!message) return;

      let chatHistory = document.getElementById("aiChatHistory");

      // Add user message
      let userBubble = document.createElement("div");
      userBubble.style.cssText = "align-self: flex-end; background: cyan; color: black; padding: 10px 14px; border-radius: 12px; border-bottom-right-radius: 0; max-width: 85%; font-weight: 500; font-size: 14px;";
      userBubble.innerText = message;
      chatHistory.appendChild(userBubble);
      inputField.value = "";

      // Scroll to bottom
      chatHistory.scrollTop = chatHistory.scrollHeight;

      // Add loading state
      let loadingBubble = document.createElement("div");
      loadingBubble.style.cssText = "align-self: flex-start; background: rgba(0, 255, 255, 0.1); padding: 10px 14px; border-radius: 12px; border-bottom-left-radius: 0; max-width: 85%; border: 1px solid rgba(0, 255, 255, 0.3); font-style: italic; color: cyan; font-size: 14px;";
      loadingBubble.innerText = "Thinking...";
      chatHistory.appendChild(loadingBubble);
      chatHistory.scrollTop = chatHistory.scrollHeight;

      if (!NEXTGEN_AI) {
        setTimeout(() => {
          chatHistory.removeChild(loadingBubble);
          addAiResponse("‚ö†Ô∏è **API Key is missing!** <br><br>Developer needs to paste the Gemini API Key into the JavaScript code (`const NEXTGEN_AI = 'YOUR_KEY_HERE';`) for me to connect to the internet and answer your questions.");
        }, 1500);
        return;
      }

      // Call Gemini API
      try {
        let response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${NEXTGEN_AI}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            contents: [{ parts: [{ text: "You are a helpful AI tutor for a college student. Keep your answers concise, educational, formatted nicely with markdown if needed, and easy to understand. Student's query: " + message }] }]
          })
        });

        let data = await response.json();
        chatHistory.removeChild(loadingBubble);

        if (data.candidates && data.candidates.length > 0) {
          let aiText = data.candidates[0].content.parts[0].text;
          addAiResponse(aiText);
        } else if (data.error) {
          addAiResponse("‚ö†Ô∏è API Error: " + data.error.message);
        } else {
          addAiResponse("Sorry, I couldn't generate a response. Please try again.");
        }
      } catch (error) {
        chatHistory.removeChild(loadingBubble);
        addAiResponse("Oops! A network error occurred while connecting to my brain. Please check your internet connection.");
      }
    }

    function addAiResponse(text) {
      let chatHistory = document.getElementById("aiChatHistory");
      let aiBubble = document.createElement("div");
      aiBubble.style.cssText = "align-self: flex-start; background: rgba(0, 255, 255, 0.1); padding: 10px 14px; border-radius: 12px; border-bottom-left-radius: 0; max-width: 85%; border: 1px solid rgba(0, 255, 255, 0.3); color: white; font-size: 14px; line-height: 1.5;";

      // Convert basic markdown to HTML for better readability
      text = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
      text = text.replace(/\*(.*?)\*/g, '<i>$1</i>');
      text = text.replace(/\n/g, '<br>');

      aiBubble.innerHTML = text;
      chatHistory.appendChild(aiBubble);
      chatHistory.scrollTop = chatHistory.scrollHeight;
    }

    function previewPremiumQR(event) {
      let file = event.target.files[0];
      if (file) {
        let reader = new FileReader();
        reader.onload = function (e) {
          let img = new Image();
          img.onload = function () {
            let canvas = document.createElement("canvas");
            let MAX_WIDTH = 400;
            let MAX_HEIGHT = 400;
            let width = img.width;
            let height = img.height;

            if (width > height) {
              if (width > MAX_WIDTH) {
                height *= MAX_WIDTH / width;
                width = MAX_WIDTH;
              }
            } else {
              if (height > MAX_HEIGHT) {
                width *= MAX_HEIGHT / height;
                height = MAX_HEIGHT;
              }
            }

            canvas.width = width;
            canvas.height = height;
            let ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, width, height);

            let preview = document.getElementById("premiumQRPreview");
            preview.src = canvas.toDataURL("image/jpeg", 0.6); // Compress aggressively
            preview.style.display = "block";
          };
          img.src = e.target.result;
        }
        reader.readAsDataURL(file);
      }
    }

    function savePremiumConfig() {
      let course = document.getElementById("premConfigCourse") ? document.getElementById("premConfigCourse").value : "";
      let option = document.getElementById("premConfigOption") ? document.getElementById("premConfigOption").value : "";

      if (!course || !option) {
        // fallback to saving global config if elements missing or not selected 
        saveGlobalPremiumConfig();
        return;
      }

      let preview = document.getElementById("premiumQRPreview");
      let qrBase64 = preview.src && preview.style.display !== "none" ? preview.src : "";

      let upi = document.getElementById("premiumUPI").value.trim();
      let amount = document.getElementById("premiumAmount").value.trim();

      let payload = {
        qr: qrBase64,
        upi,
        amount
      };

      let itemKey = course + "_" + option;
      let pConf = JSON.parse(localStorage.getItem("premiumCourseConfigs")) || {};
      pConf[itemKey] = payload;

      database.ref('premiumCourseConfigs/' + itemKey).set(payload).then(() => {
        localStorage.setItem("premiumCourseConfigs", JSON.stringify(pConf));
        alert("‚úÖ Premium Payment Settings for " + course + " - " + option + " saved successfully!");
      }).catch(err => {
        console.error(err);
        alert("‚ùå Failed to save! Your QR image might still be too large. Please upload an image under 1MB.");
      });
    }

    function saveGlobalPremiumConfig() {
      let preview = document.getElementById("premiumQRPreview");
      let qrBase64 = preview.src && preview.style.display !== "none" ? preview.src : "";

      let upi = document.getElementById("premiumUPI").value.trim();
      let amount = document.getElementById("premiumAmount").value.trim();

      let payload = {
        qr: qrBase64,
        upi,
        amount
      };

      database.ref('premiumConfig').set(payload).then(() => {
        localStorage.setItem("premiumConfig", JSON.stringify(payload));
        alert("‚úÖ Global Premium Payment Settings saved successfully!");
      }).catch(err => {
        console.error(err);
        alert("‚ùå Failed to save! Your QR image might still be too large. Please upload an image under 1MB.");
      });
    }

    /* PREMIUM NOTES & BOOK LOGIC */
    let selectedPremiumItem = "";

    function openPremiumHub() {
      document.getElementById("programsWrapper").style.display = "none";
      document.getElementById("semesterMotivationSection").style.display = "none";
      document.getElementById("premiumNavSection").style.display = "block";
      document.getElementById("premiumCoursesContainer").style.display = "grid";
      document.getElementById("premiumOptionsContainer").style.display = "none";
    }

    function goBackFromPremium() {
      if (document.getElementById("premiumContentContainer").style.display === "block") {
        document.getElementById("premiumContentContainer").style.display = "none";
        document.getElementById("premiumOptionsContainer").style.display = "grid";
      } else if (document.getElementById("premiumOptionsContainer").style.display === "grid") {
        document.getElementById("premiumOptionsContainer").style.display = "none";
        document.getElementById("premiumCoursesContainer").style.display = "grid";
      } else {
        document.getElementById("premiumNavSection").style.display = "none";
        document.getElementById("programsWrapper").style.display = "block";
      }
    }

    function goBackToPremiumOptions() {
      document.getElementById("premiumContentContainer").style.display = "none";
      document.getElementById("premiumOptionsContainer").style.display = "grid";
    }

    function showPremiumOptions(course) {
      document.getElementById("premiumCoursesContainer").style.display = "none";
      document.getElementById("premiumContentContainer").style.display = "none"; // Hide content if any
      let container = document.getElementById("premiumOptionsContainer");
      container.style.display = "grid";
      container.innerHTML = "<p style='color:cyan; grid-column:1/-1;'>Loading premium items...</p>";

      let optionsObj = premiumData[course] || {};
      let options = Object.keys(optionsObj);

      if (options.length === 0) {
        container.innerHTML = "<p style='color:#ccc; grid-column:1/-1;'>No premium options available for this course yet.</p>";
        return;
      }

      database.ref('users/' + currentUserMobile).once('value').then(snap => {
        let stObj = snap.val() || {};
        if (!stObj.premiumUnlocked) stObj.premiumUnlocked = {};

        container.innerHTML = "";
        options.forEach(opt => {
          let itemKey = course + "_" + opt;
          let isUnlocked = stObj.premiumUnlocked[itemKey];

          let classes = "box premium-box ";
          let icon = isUnlocked ? "üîì" : "üîí";
          if (!isUnlocked) classes += "locked-option";

          container.innerHTML += `<div class="${classes}" onclick="handlePremiumClick('${course}', '${opt}', ${isUnlocked ? 'true' : 'false'})">
            <h2>${icon} ${opt}</h2>
          </div>`;
        });
      });
    }

    function handlePremiumClick(course, option, isUnlocked) {
      let itemKey = course + "_" + option;
      if (isUnlocked) {
        showPremiumContent(course, option);
      } else {
        // Check if there's a pending or rejected payment in Firebase DB
        database.ref('pendingPayments').once('value').then(snap => {
          let pendingData = snap.val() || {};
          let existingReqId = null;
          let existingReq = null;

          for (let id in pendingData) {
            let req = pendingData[id];
            if (req.mobile === currentUserMobile && req.itemKey === itemKey) {
              existingReqId = id;
              existingReq = req;
              break;
            }
          }

          if (existingReq) {
            if (existingReq.status === "pending") {
              alert("‚è≥ Your payment for this item is currently under verification by Admin.");
              return;
            } else if (existingReq.status === "rejected") {
              alert("‚ùå Admin rejected your previous payment attempt.\nReason: " + existingReq.reason + "\n\nPlease provide real proofs.");
              // Remove the rejected request so they can try again
              database.ref('pendingPayments/' + existingReqId).remove();
            }
          }

          selectedPremiumItem = itemKey;
          openPaymentModal();
        });
      }
    }

    function showPremiumContent(course, option) {
      document.getElementById("premiumOptionsContainer").style.display = "none";
      let pContainer = document.getElementById("premiumContentContainer");
      pContainer.style.display = "block";

      document.getElementById("activePremiumOptionTitle").innerHTML = `üíé ${course} - ${option}`;

      let grid = document.getElementById("premiumPdfsGrid");
      grid.innerHTML = "";

      let pdfs = premiumData[course][option] || [];

      if (pdfs.length === 0) {
        grid.innerHTML = "<p style='color:#ccc;'>No PDFs available in this section yet.</p>";
        return;
      }

      pdfs.forEach(pdf => {
        let box = document.createElement("div");
        box.style.cssText = "background: rgba(255, 255, 255, 0.05); border: 1px solid cyan; border-radius: 10px; padding: 20px; text-align: center; cursor: pointer; transition: 0.3s; box-shadow: 0 0 10px rgba(0,255,255,0.1);";
        box.innerHTML = `<h1 style="margin:0 0 10px 0; font-size:40px; text-shadow: 0 0 10px gold;">üìÑ</h1>
                         <h3 style="margin:0; color:white;">${pdf.title}</h3>`;
        box.onmouseenter = () => box.style.transform = "scale(1.05)";
        box.onmouseleave = () => box.style.transform = "scale(1)";
        box.onclick = () => window.open(pdf.link, "_blank");
        grid.appendChild(box);
      });
    }

    function openPaymentModal() {
      let globalConf = JSON.parse(localStorage.getItem("premiumConfig")) || {};
      let courseConfigs = JSON.parse(localStorage.getItem("premiumCourseConfigs")) || {};

      let specificConfig = courseConfigs[selectedPremiumItem];
      let pConf = specificConfig ? specificConfig : globalConf;

      let activeAmount = pConf.amount && pConf.amount.trim() !== "" ? pConf.amount : "49";
      let baseUpi = pConf.upi && pConf.upi.trim() !== "" && pConf.upi !== "admin@upi" ? pConf.upi : "adityakumar84282-1@oksbi";

      document.getElementById("paymentAmountDisplay").innerText = "‚Çπ" + activeAmount;
      document.getElementById("paymentUPIDisplay").innerText = "UPI ID: " + baseUpi;
      let qrImg = document.getElementById("paymentQRDisplay");
      if (pConf.qr && pConf.qr.startsWith("data:image")) {
        qrImg.src = pConf.qr;
        qrImg.style.display = "inline-block";
      } else if (pConf.qr && pConf.qr.trim() !== "") {
        // Fallback for old URL-based configs if any
        qrImg.src = pConf.qr;
        qrImg.style.display = "inline-block";
      } else {
        // Generate dynamic QR code if not explicitly configured
        let upiString = `upi://pay?pa=${baseUpi}&pn=NextGenLibrary&am=${activeAmount}&cu=INR`;
        qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(upiString)}`;
        qrImg.style.display = "inline-block";
      }

      document.getElementById("paymentModal").style.display = "flex";
    }

    function closePaymentModal() {
      document.getElementById("paymentModal").style.display = "none";
      selectedPremiumItem = "";
    }

    function payWithUpiApp(app) {
      let globalConf = JSON.parse(localStorage.getItem("premiumConfig")) || {};
      let courseConfigs = JSON.parse(localStorage.getItem("premiumCourseConfigs")) || {};

      let specificConfig = courseConfigs[selectedPremiumItem];
      let pConf = specificConfig ? specificConfig : globalConf;

      let activeAmount = pConf.amount && pConf.amount.trim() !== "" ? pConf.amount : "49";
      let baseUpi = pConf.upi && pConf.upi.trim() !== "" && pConf.upi !== "admin@upi" ? pConf.upi : "adityakumar84282-1@oksbi";

      let upiStr = `upi://pay?pa=${baseUpi}&pn=NextGenLibrary&am=${activeAmount}&cu=INR`;
      if (app === 'gpay') {
        upiStr = `tez://upi/pay?pa=${baseUpi}&pn=NextGenLibrary&am=${activeAmount}&cu=INR`;
      } else if (app === 'phonepe') {
        upiStr = `phonepe://pay?pa=${baseUpi}&pn=NextGenLibrary&am=${activeAmount}&cu=INR`;
      }
      window.location.href = upiStr;
    }

    let currentScreenshotBase64 = "";

    function previewPaymentScreenshot(event) {
      let file = event.target.files[0];
      if (file) {
        let reader = new FileReader();
        reader.onload = function (e) {
          currentScreenshotBase64 = e.target.result;
          let preview = document.getElementById("paymentScreenshotPreview");
          preview.src = currentScreenshotBase64;
          preview.style.display = "block";
        }
        reader.readAsDataURL(file);
      }
    }

    function confirmPremiumPayment() {
      if (!selectedPremiumItem) return;

      let utrInput = document.getElementById("paymentUtrInput").value.trim();
      if (!utrInput || utrInput.length !== 12) {
        alert("‚ö†Ô∏è Please enter a valid 12-Digit UTR / Transaction ID.");
        return;
      }

      if (!currentScreenshotBase64) {
        alert("‚ö†Ô∏è Please upload a Payment Screenshot as proof.");
        return;
      }

      let btn = document.querySelector(".confirm-pay-btn");
      btn.innerText = "Submitting...";
      btn.disabled = true;

      // Make sure we have the latest user name from Firebase
      database.ref('users/' + currentUserMobile).once('value').then(snap => {
        let userName = "Student";
        if (snap.exists() && snap.val().name) {
          userName = snap.val().name;
        }

        let newReqId = Date.now().toString();
        let payload = {
          id: newReqId,
          mobile: currentUserMobile,
          name: userName,
          itemKey: selectedPremiumItem,
          utr: utrInput,
          screenshot: currentScreenshotBase64,
          status: "pending",
          timestamp: Date.now()
        };

        return database.ref('pendingPayments/' + newReqId).set(payload);
      }).then(() => {
        alert("‚è≥ Payment Request Submitted!\nAdmin will verify your UTR and Screenshot. Access will be granted shortly.");

        // Cleanup Modal
        document.getElementById("paymentUtrInput").value = "";
        document.getElementById("paymentScreenshotInput").value = "";
        document.getElementById("paymentScreenshotPreview").style.display = "none";
        currentScreenshotBase64 = "";

        btn.innerText = "Submit for Verification";
        btn.disabled = false;
        closePaymentModal();
      }).catch(err => {
        console.error(err);
        alert("‚ùå Failed to submit request due to a network error or the screenshot is too large.");
        btn.innerText = "Submit for Verification";
        btn.disabled = false;
      });
    }

    /* MOTIVATION ROTATION */
    /* MOTIVATION ROTATION */
    const motivations = [
      // Bhagavad Gita / Mahabharata
      "\"Karmanye Vadhikaraste, Ma Phaleshu Kadachana. (You have a right to perform your prescribed duty, but you are not entitled to the fruits of action.)\" - Bhagavad Gita",
      "\"A person can rise through the efforts of his own mind; or draw himself down, in the same manner. Because each person is his own friend or enemy.\" - Bhagavad Gita",
      "\"Whatever happened, happened for the good. Whatever is happening, is happening for the good. Whatever will happen, will also happen for the good.\" - Mahabharata",
      "\"There is neither this world nor the world beyond nor happiness for the one who doubts.\" - Bhagavad Gita",
      "\"No one who does good work will ever come to a bad end, either here or in the world to come.\" - Bhagavad Gita",
      "\"You are what you believe in. You become that which you believe you can become.\" - Bhagavad Gita",
      "\"Change is the law of the universe. You can be a millionaire, or a pauper in an instant.\" - Bhagavad Gita",
      "\"The power of God is with you at all times; through the activities of mind, senses, breathing, and emotions; and is constantly doing all the work using you as a mere instrument.\" - Bhagavad Gita",
      "\"When meditation is mastered, the mind is unwavering like the flame of a lamp in a windless place.\" - Bhagavad Gita",
      "\"We are kept from our goal not by obstacles, but by a clear path to a lesser goal.\" - Mahabharata Teachings",

      // Ramayana & Epics
      "\"Truth, righteousness, and morality will always triumph over evil and deception.\" - Valmiki Ramayana",
      "\"Only the timid and the weak leave things to destiny (Daivam), but the strong and the self-reliant never fold their hands to destiny.\" - Lakshmana (Ramayana)",
      "\"There is no deity powerful as time.\" - Valmiki Ramayana",
      "\"Grief destroys one's courage. It destroys one's learning. There is no enemy greater than grief.\" - Shri Rama (Ramayana)",
      "\"Even if a person is weak, if he has the courage and the will, he can defeat the strongest of enemies.\" - Ramayana",

      // Swami Vivekananda & Spiritual Leaders
      "\"Arise, awake, and stop not till the goal is reached.\" - Swami Vivekananda",
      "\"Take up one idea. Make that one idea your life - think of it, dream of it, live on that idea.\" - Swami Vivekananda",
      "\"You cannot believe in God until you believe in yourself.\" - Swami Vivekananda",
      "\"Truth can be stated in a thousand different ways, yet each one can be true.\" - Swami Vivekananda",
      "\"In a day, when you don't come across any problems - you can be sure that you are travelling in a wrong path.\" - Swami Vivekananda",
      "\"There is no limit to the power of the human mind. The more concentrated it is, the more power is brought to bear on one point.\" - Swami Vivekananda",
      "\"Do not dwell in the past, do not dream of the future, concentrate the mind on the present moment.\" - Gautama Buddha",
      "\"The mind is everything. What you think you become.\" - Gautama Buddha",
      "\"Your work is to discover your work and then with all your heart to give yourself to it.\" - Gautama Buddha",

      // Scientists & Modern Leaders (APJ Abdul Kalam, etc.)
      "\"Dream, dream, dream. Dreams transform into thoughts and thoughts result in action.\" - Dr. A.P.J. Abdul Kalam",
      "\"If you want to shine like a sun, first burn like a sun.\" - Dr. A.P.J. Abdul Kalam",
      "\"To succeed in your mission, you must have single-minded devotion to your goal.\" - Dr. A.P.J. Abdul Kalam",
      "\"You have to dream before your dreams can come true.\" - Dr. A.P.J. Abdul Kalam",
      "\"Man needs difficulties in life because they are necessary to enjoy success.\" - Dr. A.P.J. Abdul Kalam",
      "\"Be active! Take on responsibility! Work for the things you believe in. If you do not, you are surrendering your fate to others.\" - Dr. A.P.J. Abdul Kalam",
      "\"Excellence is a continuous process and not an accident.\" - Dr. A.P.J. Abdul Kalam",
      "\"Science is a beautiful gift to humanity; we should not distort it.\" - Dr. A.P.J. Abdul Kalam",
      "\"I can't change the direction of the wind, but I can adjust my sails to always reach my destination.\" - Jimmy Dean",
      "\"First they ignore you, then they laugh at you, then they fight you, then you win.\" - Mahatma Gandhi",
      "\"Live as if you were to die tomorrow. Learn as if you were to live forever.\" - Mahatma Gandhi",
      "\"The future depends on what you do today.\" - Mahatma Gandhi",
      "\"Strength does not come from physical capacity. It comes from an indomitable will.\" - Mahatma Gandhi",
      "\"Let new India arise out of peasants' cottage, grasping the plough, out of huts, cobbler and sweeper.\" - Netaji Subhas Chandra Bose",
      "\"One individual may die for an idea, but that idea will, after his death, incarnate itself in a thousand lives.\" - Netaji Subhas Chandra Bose",
      "\"Freedom is not given, it is taken.\" - Netaji Subhas Chandra Bose",

      // Chanakya (Vishnugupta)
      "\"Education is the best friend. An educated person is respected everywhere. Education beats the beauty and the youth.\" - Chanakya",
      "\"A man is born alone and dies alone; and he experiences the good and bad consequences of his karma alone; and he goes alone to hell or the Supreme abode.\" - Chanakya",
      "\"Learn from the mistakes of others... you can't live long enough to make them all yourselves.\" - Chanakya",
      "\"As soon as the fear approaches near, attack and destroy it.\" - Chanakya",
      "\"There is no present and future of the lazy.\" - Chanakya",
      "\"Even if a snake is not poisonous, it should pretend to be venomous.\" - Chanakya",

      // IAS / IPS / Civil Services Aspirant Motivation
      "\"A dream does not become reality through magic; it takes sweat, determination, and hard work.\" - Colin Powell (UPSC Ethos)",
      "\"The rougher the seas, the smoother we sail. Ahoy!\" - Indian Navy / Armed forces ethos",
      "\"Kadi mehnat, pakka iraada, aur khud par vishwas ‚Äì yahi ekmatra rasta hai safalta ka.\" - UPSC Aspirant's Mantra",
      "\"When you feel like quitting, remember why you started.\" - IAS Training Ethos",
      "\"It‚Äôs not about how many hours you study, it‚Äôs about how much you study in those hours.\" - Civil Services Motivation",
      "\"Service before Self.\" - NDA/Defense Motto",
      "\"No matter how tough the grind, the steel is forged only in the hottest fire.\" - IPS Training Academy (SVPNPA)",
      "\"Hard work beats talent when talent doesn't work hard.\" - Tim Notke (Student Ethos)",
      "\"Push yourself, because no one else is going to do it for you.\" - Student Motivation",
      "\"Success doesn‚Äôt just find you. You have to go out and get it.\" - General Motivation",
      "\"The harder you work for something, the greater you‚Äôll feel when you achieve it.\" - General Motivation",
      "\"Don‚Äôt stop when you‚Äôre tired. Stop when you‚Äôre done.\" - General Motivation",
      "\"Wake up with determination. Go to bed with satisfaction.\" - Student Ethos",
      "\"Do something today that your future self will thank you for.\" - General Motivation"
    ];

    let currentMotivationIndex = 0;
    // Set random initial tip to feel dynamic on reload
    currentMotivationIndex = Math.floor(Math.random() * motivations.length);
    document.getElementById("motivationText").innerText = motivations[currentMotivationIndex];

    setInterval(() => {
      currentMotivationIndex = (currentMotivationIndex + 1) % motivations.length;
      document.getElementById("motivationText").innerText = motivations[currentMotivationIndex];
    }, 60000); // 60,000 ms = 1 minute




  </script>

</body>

</html>

